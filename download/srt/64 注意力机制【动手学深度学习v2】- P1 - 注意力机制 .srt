1
00:00:00,000 --> 00:00:06,280
OK 我们来讲一下我们刚刚的说的那个合回归怎么实现

2
00:00:06,839 --> 00:00:10,880
就是说因为这个东西跟我们之后有一定关系也不那么相关

3
00:00:10,880 --> 00:00:14,599
所以我们就不那么仔细的给大家讲每一行代码怎么回事

4
00:00:14,640 --> 00:00:16,480
主要给大家看一下效果是怎么回事

5
00:00:17,800 --> 00:00:21,359
我们就是给大家做一个这样子一个随机数据

6
00:00:21,359 --> 00:00:22,199
这个数据干嘛呢

7
00:00:22,240 --> 00:00:26,120
就是我的真实的FX是什么样的

8
00:00:26,480 --> 00:00:27,760
就是你给个X

9
00:00:28,000 --> 00:00:29,120
我算一个Sign

10
00:00:29,600 --> 00:00:32,000
然后加上一个X的0.8次分

11
00:00:32,359 --> 00:00:33,840
这是我真实的函数

12
00:00:34,280 --> 00:00:35,640
接下来我要去拟合它

13
00:00:35,960 --> 00:00:39,200
拟合的时候我先我的训练级是什么东西

14
00:00:40,079 --> 00:00:44,120
我训练级就是在0到1之间

15
00:00:44,439 --> 00:00:49,799
随机的0到5之间随机的生成N50个数

16
00:00:50,280 --> 00:00:53,719
然后把它排个序对吧

17
00:00:53,719 --> 00:00:54,760
就一些随机点

18
00:00:55,359 --> 00:00:57,880
我对的Label就是用来训练Label

19
00:00:58,280 --> 00:00:59,560
它的真实的函数

20
00:00:59,679 --> 00:01:01,120
再加上一个噪音

21
00:01:01,120 --> 00:01:04,840
就是方差为0.5的一个高斯噪音加在里面

22
00:01:06,200 --> 00:01:07,799
然后我给你做测试的

23
00:01:08,000 --> 00:01:09,640
就是XText就是那些key

24
00:01:09,799 --> 00:01:11,760
就是说我给你说我的测试

25
00:01:11,760 --> 00:01:13,680
其实是一个0到5之间

26
00:01:13,680 --> 00:01:17,159
就是均匀的按0.1均匀的东西

27
00:01:18,000 --> 00:01:19,800
加上我的Truth就是说我真实的

28
00:01:19,800 --> 00:01:21,280
当然就是丢到F里面

29
00:01:21,480 --> 00:01:25,680
现在你的任务是说给定X来测试

30
00:01:25,720 --> 00:01:27,880
来预测我的Y Truth

31
00:01:28,640 --> 00:01:29,080
OK

32
00:01:29,800 --> 00:01:32,320
当然我下一个函数就是给大家画一下

33
00:01:32,320 --> 00:01:33,240
画一下这个函数

34
00:01:33,240 --> 00:01:34,360
你可以看到是说

35
00:01:35,720 --> 00:01:36,960
黄色这个点

36
00:01:37,200 --> 00:01:40,480
黄色这个点就是你的训练的点

37
00:01:41,000 --> 00:01:43,080
所以它的X是比较随机的

38
00:01:43,760 --> 00:01:47,040
它的Y就是因为有也是随机的

39
00:01:47,040 --> 00:01:47,840
因为有随机噪音

40
00:01:48,960 --> 00:01:52,560
所以然后你这个南线就是你的

41
00:01:52,680 --> 00:01:57,000
真实的Y的值

42
00:01:57,000 --> 00:01:59,640
就是你这是你真实的值

43
00:02:00,439 --> 00:02:01,760
如果我们用最简单的

44
00:02:01,760 --> 00:02:03,120
就是说把它

45
00:02:03,879 --> 00:02:05,680
我们用最简单的平均

46
00:02:05,680 --> 00:02:06,560
就是我给个

47
00:02:07,400 --> 00:02:08,599
我给你X

48
00:02:08,599 --> 00:02:09,439
我什么都不管

49
00:02:09,439 --> 00:02:11,560
我就把你说的Y作为均值的话

50
00:02:11,560 --> 00:02:13,199
那么你的预测就是你

51
00:02:14,080 --> 00:02:16,199
predict的就是粉红线

52
00:02:16,719 --> 00:02:18,240
当然你知道不靠谱对吧

53
00:02:18,280 --> 00:02:19,280
因为这个函数

54
00:02:19,280 --> 00:02:21,319
我这个东西我是根据X的不同

55
00:02:21,319 --> 00:02:23,879
我当然可能要去看不同的东西

56
00:02:23,879 --> 00:02:26,120
所以你这样子是肯定是

57
00:02:26,519 --> 00:02:28,759
完全还原不出我这个曲线

58
00:02:30,719 --> 00:02:32,239
接下来我们用的是

59
00:02:32,639 --> 00:02:36,680
刚刚提到的非参数的注意力

60
00:02:37,719 --> 00:02:40,000
我们这写的是汇聚

61
00:02:40,159 --> 00:02:41,159
就是池化

62
00:02:41,159 --> 00:02:43,919
就我们跟周志华老师李航老师

63
00:02:43,919 --> 00:02:44,560
就讨论了

64
00:02:44,560 --> 00:02:47,079
还发现池化中文翻译不是那么好

65
00:02:47,079 --> 00:02:48,240
就是说大家说

66
00:02:48,240 --> 00:02:50,439
我们要不干脆换成汇聚这个翻译

67
00:02:50,680 --> 00:02:51,240
就pooling

68
00:02:51,840 --> 00:02:52,879
就pooling就是说

69
00:02:52,879 --> 00:02:54,520
你就是把东西给聚到一起来

70
00:02:54,520 --> 00:02:55,039
对吧

71
00:02:56,120 --> 00:02:57,840
这东西我就不给大家讲实现了

72
00:02:57,840 --> 00:02:59,280
其实挺简单

73
00:02:59,280 --> 00:03:00,879
就是说你就把

74
00:03:02,079 --> 00:03:04,560
我又把我的X那个东西

75
00:03:05,000 --> 00:03:08,280
就是要就repeat interleave

76
00:03:08,280 --> 00:03:09,840
就是说把1234变成

77
00:03:09,840 --> 00:03:11,759
1122333344

78
00:03:11,759 --> 00:03:12,919
那个重复多少次

79
00:03:12,919 --> 00:03:14,439
是用这个东西来控制的

80
00:03:14,759 --> 00:03:16,439
然后这样子的话

81
00:03:16,479 --> 00:03:19,400
我就可以按每个点之间做一个减法

82
00:03:19,400 --> 00:03:21,640
然后平方向除个2

83
00:03:21,640 --> 00:03:23,760
然后丢到softmax里面

84
00:03:24,360 --> 00:03:24,760
对吧

85
00:03:24,760 --> 00:03:26,200
然后这就是我的weight了

86
00:03:27,040 --> 00:03:27,920
得到weight之后

87
00:03:28,159 --> 00:03:29,159
我就把你这个Y

88
00:03:30,000 --> 00:03:30,960
你的Y的序列

89
00:03:31,080 --> 00:03:32,640
就是按照你的权重

90
00:03:32,640 --> 00:03:34,400
给你来乘一下

91
00:03:34,400 --> 00:03:35,719
就得到我的预测了

92
00:03:36,200 --> 00:03:37,480
所以直观上来讲

93
00:03:37,680 --> 00:03:38,200
你是干嘛

94
00:03:38,360 --> 00:03:41,800
就是任何给一个X进来

95
00:03:42,400 --> 00:03:44,599
我去找一下

96
00:03:44,800 --> 00:03:47,040
跟我附近比较近的点

97
00:03:47,200 --> 00:03:49,040
给他们比较大的权重

98
00:03:49,120 --> 00:03:50,479
然后把这些点的Y值

99
00:03:50,479 --> 00:03:51,439
给你弄在一起

100
00:03:52,439 --> 00:03:53,319
所以你的预测

101
00:03:53,439 --> 00:03:56,000
就是这一根线

102
00:03:56,120 --> 00:03:57,560
这个桃红色的线

103
00:03:57,879 --> 00:03:58,840
基本上你可以看到

104
00:03:58,840 --> 00:04:00,000
还是多多少少

105
00:04:00,359 --> 00:04:01,560
还是有一点趋势的

106
00:04:01,560 --> 00:04:02,039
对吧

107
00:04:02,479 --> 00:04:03,239
这个地方

108
00:04:03,799 --> 00:04:06,560
它是因为它是在这一块

109
00:04:06,759 --> 00:04:07,199
这一块

110
00:04:07,199 --> 00:04:09,359
然后给你取一个加权平均

111
00:04:09,479 --> 00:04:11,439
所以因为这个点比较小

112
00:04:11,439 --> 00:04:12,479
就一个点在这个地方

113
00:04:12,639 --> 00:04:15,079
所以它就是比较偏这边一点

114
00:04:15,280 --> 00:04:16,480
然后到这个地方也是

115
00:04:17,240 --> 00:04:19,439
虽然这些点都在这个地方

116
00:04:19,439 --> 00:04:22,000
但是它可能会考虑这些点做平均

117
00:04:22,000 --> 00:04:24,080
所以线相对上拉的比较大

118
00:04:24,439 --> 00:04:25,240
就基本上认为

119
00:04:25,439 --> 00:04:26,960
它就是一个很平滑的

120
00:04:26,960 --> 00:04:28,160
就是说对你这个东西

121
00:04:28,520 --> 00:04:30,680
做一个平滑的回归

122
00:04:31,000 --> 00:04:31,400
对吧

123
00:04:31,400 --> 00:04:32,800
就一个平滑的加权平均

124
00:04:32,800 --> 00:04:34,680
就是你有个滑动窗在那边

125
00:04:34,759 --> 00:04:35,560
平滑过去

126
00:04:35,920 --> 00:04:38,680
所以它不那么适合我们这个地方

127
00:04:38,680 --> 00:04:43,280
是因为我们曲线变化的比较大

128
00:04:43,400 --> 00:04:44,520
然后你那个东西

129
00:04:45,039 --> 00:04:46,839
好像是过于平滑了

130
00:04:47,359 --> 00:04:47,719
对吧

131
00:04:47,719 --> 00:04:50,439
所以这个就是非参的一个问题

132
00:04:50,680 --> 00:04:52,359
非参的好处是什么样子

133
00:04:52,359 --> 00:04:54,159
好处不需要学

134
00:04:54,240 --> 00:04:55,919
然后你要理论证明是说

135
00:04:55,919 --> 00:04:58,000
只要给你足够多的数据

136
00:04:58,000 --> 00:05:00,639
我确实是能够把原始的模型弄出来的

137
00:05:01,039 --> 00:05:01,839
但是问题是说

138
00:05:01,959 --> 00:05:03,079
我不会给你足够多数据

139
00:05:03,079 --> 00:05:03,879
就现实生活中

140
00:05:03,879 --> 00:05:05,120
你没有那么多数据

141
00:05:05,279 --> 00:05:08,759
所以非参在基因学习里面用的不那么多

142
00:05:08,759 --> 00:05:11,079
因为确实数据不多

143
00:05:12,519 --> 00:05:13,279
那么同样东西

144
00:05:13,400 --> 00:05:14,240
我们可以实现

145
00:05:14,240 --> 00:05:15,840
我们在实现之前

146
00:05:15,840 --> 00:05:16,280
我们讲一下

147
00:05:16,320 --> 00:05:18,920
就是说这个东西是一个叫做

148
00:05:19,080 --> 00:05:20,360
看一下你的权重

149
00:05:20,360 --> 00:05:21,640
就是说权重

150
00:05:21,720 --> 00:05:23,760
我们就是叫做注意力的权重

151
00:05:24,760 --> 00:05:25,880
这个函数我就不给大家讲了

152
00:05:25,880 --> 00:05:27,480
就把那个画一下

153
00:05:28,240 --> 00:05:29,240
基本上你可以认为

154
00:05:30,640 --> 00:05:31,840
任何一行

155
00:05:32,600 --> 00:05:33,880
就是说任何一行

156
00:05:33,880 --> 00:05:35,400
就表示说第i行

157
00:05:35,720 --> 00:05:38,480
就表示第i个测试样本里面

158
00:05:38,680 --> 00:05:40,320
在算它的时候

159
00:05:41,279 --> 00:05:44,719
那些给每一个训练的

160
00:05:44,719 --> 00:05:45,839
那些key value pair

161
00:05:46,399 --> 00:05:48,240
就xi给的权重

162
00:05:48,240 --> 00:05:49,159
就给你画出来

163
00:05:50,000 --> 00:05:51,279
就基本上你可以看到

164
00:05:51,279 --> 00:05:53,519
第一个就最那边数值

165
00:05:53,959 --> 00:05:54,719
就当然是说

166
00:05:54,719 --> 00:05:56,439
给前面那些训练样本

167
00:05:56,439 --> 00:05:57,399
比较大的权重

168
00:05:57,439 --> 00:05:59,039
因为确实跟前面的比较近

169
00:05:59,120 --> 00:06:01,000
然后你当然是慢慢到中间的时候

170
00:06:01,000 --> 00:06:01,759
在中间的时候

171
00:06:01,759 --> 00:06:04,279
因为它的权重还是比较散的

172
00:06:04,399 --> 00:06:05,480
就中间那一块

173
00:06:05,639 --> 00:06:06,560
就中间那些点

174
00:06:07,199 --> 00:06:08,519
对训练样本来讲

175
00:06:08,519 --> 00:06:10,799
它对中间那些训练样本

176
00:06:11,039 --> 00:06:12,279
就那些黄色的块块

177
00:06:12,759 --> 00:06:14,680
给的权重也还是比较均匀的

178
00:06:14,680 --> 00:06:15,680
但越到后面

179
00:06:15,680 --> 00:06:19,399
稍微就是越靠越集中一点

180
00:06:19,759 --> 00:06:21,719
但整体来看是比较平滑的

181
00:06:21,919 --> 00:06:23,279
就是说特别中间这些点

182
00:06:23,479 --> 00:06:26,159
它会要看比较宽的一段区域

183
00:06:26,199 --> 00:06:27,879
要给他们相对来说

184
00:06:29,519 --> 00:06:30,240
都不大

185
00:06:30,240 --> 00:06:32,159
但是每个人都给一点值

186
00:06:32,159 --> 00:06:35,799
所以曲线就显得特别平滑

187
00:06:36,800 --> 00:06:38,840
当然我们接下来就是可以训练

188
00:06:38,840 --> 00:06:41,680
那个可以学的参数

189
00:06:43,319 --> 00:06:44,360
在讲之前

190
00:06:44,759 --> 00:06:46,040
我们也讲一下这个东西

191
00:06:46,040 --> 00:06:46,879
叫做BNN

192
00:06:46,879 --> 00:06:49,160
就是Batch的局限乘法

193
00:06:49,240 --> 00:06:49,759
是什么意思

194
00:06:50,319 --> 00:06:51,720
就是说你做局限乘法

195
00:06:51,720 --> 00:06:53,759
就是我给一个14矩限

196
00:06:53,759 --> 00:06:54,600
给个46矩限

197
00:06:54,600 --> 00:06:55,480
那么做局限乘法

198
00:06:55,480 --> 00:06:56,160
就变成个16

199
00:06:56,160 --> 00:06:56,639
对吧

200
00:06:57,199 --> 00:06:58,759
在如果有个Batch Size怎么办

201
00:06:59,199 --> 00:07:00,280
有个Batch Size的意思

202
00:07:00,280 --> 00:07:00,560
就是说

203
00:07:00,560 --> 00:07:01,960
如果有个N在这个地方

204
00:07:02,319 --> 00:07:04,040
就是对里面每一个

205
00:07:04,200 --> 00:07:05,760
第0个14

206
00:07:05,760 --> 00:07:07,879
我跟他里面的第0个14

207
00:07:07,920 --> 00:07:08,879
做了乘法

208
00:07:09,000 --> 00:07:12,319
他的第一个14

209
00:07:12,600 --> 00:07:14,800
跟他里面第一个14做局限乘法

210
00:07:15,640 --> 00:07:15,960
OK

211
00:07:15,960 --> 00:07:16,800
所以你乘出来

212
00:07:16,800 --> 00:07:18,360
就会得出一个20不变的

213
00:07:18,360 --> 00:07:19,879
因为它是一个小批量

214
00:07:20,240 --> 00:07:21,360
就是对小批量里面

215
00:07:21,360 --> 00:07:22,400
每一个局限乘法

216
00:07:22,439 --> 00:07:23,360
做一个局限乘法

217
00:07:23,360 --> 00:07:24,360
然后放在那个地方

218
00:07:24,800 --> 00:07:27,040
叫BNN这个东西

219
00:07:27,160 --> 00:07:28,200
我们之后会

220
00:07:28,600 --> 00:07:30,080
接下来在实现Tension的时候

221
00:07:30,080 --> 00:07:30,600
会用到

222
00:07:31,600 --> 00:07:33,960
然后我们就不仔细看

223
00:07:33,960 --> 00:07:36,760
这个我们也不给大家过一遍了

224
00:07:36,760 --> 00:07:37,400
就是说

225
00:07:37,400 --> 00:07:38,800
基本上就是把刚刚那个东西

226
00:07:38,800 --> 00:07:39,840
加一个W进来

227
00:07:40,600 --> 00:07:42,080
就W是说

228
00:07:43,240 --> 00:07:44,560
就W在高

229
00:07:44,560 --> 00:07:46,080
如果大家知道和方法

230
00:07:46,240 --> 00:07:47,640
W这个东西控制的是

231
00:07:47,640 --> 00:07:50,480
高斯和的那一个窗口的大小

232
00:07:50,960 --> 00:07:52,280
你可以控制那个东西

233
00:07:52,280 --> 00:07:53,439
不那么平滑一点

234
00:07:53,439 --> 00:07:54,800
和控制的很平滑

235
00:07:54,800 --> 00:07:56,200
就W是干这个事情的

236
00:07:56,360 --> 00:07:59,040
所以我们希望通过学习一个W

237
00:07:59,040 --> 00:08:01,000
指的说你到底是我这个曲线

238
00:08:01,000 --> 00:08:01,680
应该平滑一点

239
00:08:01,680 --> 00:08:02,840
还是不平滑一点

240
00:08:02,960 --> 00:08:04,160
然后可以去训练

241
00:08:04,400 --> 00:08:05,439
所以我们就不看了

242
00:08:06,080 --> 00:08:06,840
你就把它实现了

243
00:08:06,840 --> 00:08:08,000
然后丢过去训练一下

244
00:08:09,319 --> 00:08:10,080
训练我们也不看

245
00:08:10,080 --> 00:08:11,600
就直接看一下最后结果

246
00:08:12,400 --> 00:08:14,320
就假设我去训练W的话

247
00:08:14,520 --> 00:08:15,920
那么你会发现说

248
00:08:16,120 --> 00:08:18,280
我发现数据比较小

249
00:08:18,280 --> 00:08:19,600
然后为了你和数据的话

250
00:08:19,600 --> 00:08:22,800
我需要一个比较窄一点的窗口

251
00:08:22,920 --> 00:08:24,759
所以就导致我整个曲线

252
00:08:24,759 --> 00:08:26,800
就变得不那么平滑

253
00:08:27,160 --> 00:08:28,120
就是说你看这个线

254
00:08:28,840 --> 00:08:30,000
不那么平滑的好处

255
00:08:30,000 --> 00:08:31,600
是说你确实的

256
00:08:31,600 --> 00:08:32,879
你和好了很多

257
00:08:32,879 --> 00:08:33,399
对吧

258
00:08:33,399 --> 00:08:34,240
就是说你线

259
00:08:34,240 --> 00:08:36,039
跟红线

260
00:08:36,240 --> 00:08:38,000
桃红线和蓝线

261
00:08:38,000 --> 00:08:40,240
基本上比较靠近了

262
00:08:41,200 --> 00:08:42,200
但坏处当然是说

263
00:08:42,200 --> 00:08:43,480
你确实有点噪音

264
00:08:43,639 --> 00:08:44,759
你看它有点抖动

265
00:08:46,600 --> 00:08:47,480
另外一块可以看一下

266
00:08:47,480 --> 00:08:49,600
它学习到的权重

267
00:08:50,519 --> 00:08:52,159
就是说因为它的W

268
00:08:52,159 --> 00:08:54,200
是整个窗口变窄的话

269
00:08:54,200 --> 00:08:57,000
所以每一个测试的时候

270
00:08:57,000 --> 00:08:59,600
我给对应的训练样本分的权重

271
00:08:59,600 --> 00:09:01,759
相对来说比较集中了

272
00:09:02,159 --> 00:09:03,440
就基本上你可以看到

273
00:09:03,879 --> 00:09:07,960
现在我只给跟我X比较近的

274
00:09:07,960 --> 00:09:08,960
那些XI

275
00:09:09,360 --> 00:09:11,240
给了比较大的权重

276
00:09:11,240 --> 00:09:13,039
别的都是给的比较小

277
00:09:13,440 --> 00:09:13,879
对吧

278
00:09:13,879 --> 00:09:14,759
你看第一

279
00:09:14,759 --> 00:09:16,080
基本上这一行

280
00:09:16,080 --> 00:09:17,679
基本上就放在就是说

281
00:09:18,120 --> 00:09:19,519
它对应的位置

282
00:09:19,519 --> 00:09:20,559
给的比较大的权重

283
00:09:20,559 --> 00:09:21,600
别的就没给了

284
00:09:22,279 --> 00:09:23,279
所以就是说

285
00:09:23,559 --> 00:09:25,240
这里我们通过学习W

286
00:09:25,279 --> 00:09:27,919
使得你可以把你的

287
00:09:29,799 --> 00:09:32,039
注意力权重那个东西

288
00:09:32,320 --> 00:09:33,120
训练得更好

289
00:09:33,120 --> 00:09:35,399
使得你喝的更加好一点

290
00:09:36,360 --> 00:09:36,680
OK

291
00:09:36,680 --> 00:09:40,759
这就是我们在刚刚讲过的一些代码的实现

292
00:09:43,240 --> 00:09:44,440
虽然跟我们之后讲的

293
00:09:44,440 --> 00:09:45,600
没有太多联系

294
00:09:45,759 --> 00:09:47,000
主要是给大家说

295
00:09:47,519 --> 00:09:49,519
看一下就是这个东西也不那么

296
00:09:49,519 --> 00:09:51,080
不是说完全全新的

297
00:09:51,080 --> 00:09:53,519
其实说从比较简单的思路

298
00:09:53,519 --> 00:09:54,639
可以一直一直扩大

299
00:09:54,639 --> 00:09:57,039
来到我们现在相对来说

300
00:09:57,039 --> 00:09:59,279
比较复杂的注意力机制的设计

