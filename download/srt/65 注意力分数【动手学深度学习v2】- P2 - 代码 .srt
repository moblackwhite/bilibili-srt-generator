1
00:00:00,000 --> 00:00:02,879
刚刚我们说的注意力权重

2
00:00:02,879 --> 00:00:03,839
怎么样设计

3
00:00:03,839 --> 00:00:06,600
它使得更加跟我们现在的东西比较相像

4
00:00:07,120 --> 00:00:10,679
这东西也里面都有一个东西叫做注意力分数

5
00:00:12,720 --> 00:00:13,560
首先我们来看一下

6
00:00:13,560 --> 00:00:14,480
就是说我们回顾一下

7
00:00:14,480 --> 00:00:15,800
我们刚刚讲的东西

8
00:00:15,880 --> 00:00:17,519
讲的东西是说我的

9
00:00:17,640 --> 00:00:18,920
给我一个query

10
00:00:19,120 --> 00:00:21,240
我的结果它是等价于

11
00:00:22,559 --> 00:00:25,199
我所谓的那些key value pair

12
00:00:25,719 --> 00:00:27,719
然后跟它算一个距离

13
00:00:28,000 --> 00:00:30,000
就alpha这个东西叫做注意力权重

14
00:00:30,000 --> 00:00:31,480
就是刚刚我们画的那个东西

15
00:00:32,280 --> 00:00:33,119
就是那个

16
00:00:33,159 --> 00:00:34,679
然后通常你可以写成

17
00:00:35,640 --> 00:00:37,439
就刚刚我们如果是用的高斯盒

18
00:00:37,560 --> 00:00:39,039
用的是盒汇归的话

19
00:00:39,039 --> 00:00:40,200
它就写成这个东西

20
00:00:40,879 --> 00:00:42,000
叫softmax

21
00:00:42,159 --> 00:00:45,480
加上它就是一减一平方

22
00:00:46,759 --> 00:00:49,079
这个东西叫做权重

23
00:00:49,640 --> 00:00:51,399
权重一般就是说

24
00:00:51,840 --> 00:00:53,480
是大于等于0

25
00:00:53,599 --> 00:00:54,960
然后加起来等于1

26
00:00:55,280 --> 00:00:56,439
分数就是说

27
00:00:56,479 --> 00:00:58,119
你就是一个没有normal的版本

28
00:00:58,119 --> 00:00:58,719
叫做分数

29
00:00:58,719 --> 00:00:59,839
叫注意力分数

30
00:01:00,359 --> 00:01:01,839
所以你在这个图上面看

31
00:01:01,960 --> 00:01:02,640
就是说

32
00:01:03,000 --> 00:01:05,000
我有一堆key value pair

33
00:01:05,879 --> 00:01:07,679
然后我来一个query的话

34
00:01:07,679 --> 00:01:09,799
我先query跟每一个key

35
00:01:10,000 --> 00:01:12,120
做一个alpha的一个

36
00:01:12,120 --> 00:01:14,519
做一个a

37
00:01:14,560 --> 00:01:15,759
就a几几

38
00:01:16,599 --> 00:01:17,280
把这些东西

39
00:01:17,920 --> 00:01:18,759
这东西出来

40
00:01:18,759 --> 00:01:20,359
这个东西叫做tension score

41
00:01:20,359 --> 00:01:22,719
就是叫注意力分数函数

42
00:01:23,879 --> 00:01:25,200
这个地方我们是等价

43
00:01:25,480 --> 00:01:27,079
就是这个函数等于这个东西

44
00:01:27,079 --> 00:01:28,159
但是你可以接下来

45
00:01:28,159 --> 00:01:29,280
我们设计的不一样一点

46
00:01:29,760 --> 00:01:31,200
然后给他之后

47
00:01:31,200 --> 00:01:33,040
我就会丢到softmax

48
00:01:33,879 --> 00:01:36,159
softmax就变成了注意力的权重

49
00:01:36,200 --> 00:01:37,760
然后再跟每一个value

50
00:01:37,960 --> 00:01:41,400
做加权的盒

51
00:01:41,400 --> 00:01:43,320
然后就得到我们最终的输出

52
00:01:43,480 --> 00:01:44,800
所以其实说白了

53
00:01:44,800 --> 00:01:46,719
就整个注意力机制

54
00:01:46,719 --> 00:01:47,400
是干的事情

55
00:01:47,400 --> 00:01:48,079
就这个东西

56
00:01:48,560 --> 00:01:49,800
所以这个东西都是

57
00:01:50,520 --> 00:01:50,960
一样的

58
00:01:51,120 --> 00:01:51,760
就是说

59
00:01:52,079 --> 00:01:53,000
跟我们之前不一样

60
00:01:53,000 --> 00:01:53,600
是说这个东西

61
00:01:53,600 --> 00:01:54,520
可能会变成一个向量

62
00:01:54,560 --> 00:01:55,599
不是一个值

63
00:01:55,599 --> 00:01:56,719
我们刚刚是一个值

64
00:01:57,200 --> 00:01:58,439
现在会变成一个向量

65
00:01:59,199 --> 00:02:01,239
然后另外一个是a

66
00:02:01,239 --> 00:02:02,759
a肯定这个东西

67
00:02:02,759 --> 00:02:04,119
是一个只能作为值的

68
00:02:04,519 --> 00:02:06,519
我们的设计会有一点点不一样一点

69
00:02:08,319 --> 00:02:08,560
好

70
00:02:08,560 --> 00:02:10,439
我们先看第一个想法

71
00:02:10,439 --> 00:02:13,359
怎么样把那些key value

72
00:02:13,519 --> 00:02:14,960
拓展到高维度

73
00:02:17,199 --> 00:02:19,120
假设我现在的query

74
00:02:19,120 --> 00:02:21,840
是一个常为q的一个向量

75
00:02:22,840 --> 00:02:25,680
我有m对key value的值

76
00:02:26,039 --> 00:02:28,680
那么k v

77
00:02:28,719 --> 00:02:31,879
然后这里 ki是一个常为k的向量

78
00:02:32,039 --> 00:02:33,759
v是一个常为v的向量

79
00:02:33,800 --> 00:02:36,000
这些q k v可以长得不一样

80
00:02:36,120 --> 00:02:37,039
就是说你的query

81
00:02:37,159 --> 00:02:39,120
你的那东西都可以长得不一样

82
00:02:40,520 --> 00:02:43,319
然后你的注意力持花程式干嘛

83
00:02:44,439 --> 00:02:46,159
我把key value全部写在这里面

84
00:02:46,280 --> 00:02:47,879
刚刚我们只写了x

85
00:02:47,879 --> 00:02:49,520
现在我们就全部写全

86
00:02:49,520 --> 00:02:51,439
就是给我你的query

87
00:02:51,599 --> 00:02:53,599
然后给你那些所谓的那些key value

88
00:02:53,599 --> 00:02:54,159
pair

89
00:02:54,400 --> 00:02:59,000
它等于对每一个q跟每一个key

90
00:02:59,199 --> 00:03:02,120
做一个注意力的权重

91
00:03:02,120 --> 00:03:03,359
就alpha那个函数

92
00:03:03,400 --> 00:03:05,479
然后跟它再乘以vi

93
00:03:05,520 --> 00:03:06,759
最后全部加起来

94
00:03:06,960 --> 00:03:07,960
最后你的输出

95
00:03:07,960 --> 00:03:09,439
就会等于一个v的东西

96
00:03:09,439 --> 00:03:11,960
就这个东西跟它是一样的

97
00:03:13,400 --> 00:03:15,240
然后就alpha的设计

98
00:03:15,240 --> 00:03:17,360
通常来说是等于一个softmax

99
00:03:17,360 --> 00:03:20,159
然后a q ki

100
00:03:20,280 --> 00:03:22,520
就a这个东西就是注意力分数了

101
00:03:22,520 --> 00:03:24,879
就是说就是没有被normalize掉的东西

102
00:03:25,079 --> 00:03:27,240
它当然写出来就等于这个东西

103
00:03:27,359 --> 00:03:29,639
就softmax展开就长这样子

104
00:03:30,800 --> 00:03:34,240
所以关键是说你a这个东西怎么设计

105
00:03:34,439 --> 00:03:36,560
我们接下来讲两个思路

106
00:03:36,960 --> 00:03:38,680
看看怎么设计过去了

107
00:03:41,199 --> 00:03:42,439
第一个思路叫做

108
00:03:42,719 --> 00:03:43,479
叫做

109
00:03:45,680 --> 00:03:49,879
就是可加的加性的注意力

110
00:03:51,159 --> 00:03:52,680
加性的注意力是什么意思

111
00:03:52,799 --> 00:03:55,439
就是说你的里面可以学的参数

112
00:03:55,639 --> 00:03:57,919
就有那么三个

113
00:03:58,560 --> 00:03:59,840
有一个w k

114
00:04:01,280 --> 00:04:03,439
w k就是把一个

115
00:04:03,840 --> 00:04:06,039
从k就query那个东西

116
00:04:06,159 --> 00:04:08,039
从kmap到一个h

117
00:04:08,919 --> 00:04:10,439
然后你w q

118
00:04:10,479 --> 00:04:12,280
w q是把一个q的东西

119
00:04:12,280 --> 00:04:13,159
map到一个h

120
00:04:13,159 --> 00:04:14,680
h是一个超参数

121
00:04:14,840 --> 00:04:16,720
v就是一个rh的东西

122
00:04:16,720 --> 00:04:19,759
就是w和k和w q都是主称

123
00:04:19,759 --> 00:04:20,920
v是一个向量

124
00:04:22,360 --> 00:04:23,560
然后给一个k

125
00:04:23,800 --> 00:04:25,879
k是一个常为k的一个向量

126
00:04:25,879 --> 00:04:27,719
然后q是一个常为q的向量

127
00:04:27,759 --> 00:04:28,599
你怎么做呢

128
00:04:29,079 --> 00:04:30,360
它的做法是说

129
00:04:30,519 --> 00:04:32,839
我把k跟w k相乘

130
00:04:33,159 --> 00:04:36,000
会得到一个常为一个h的一个向量

131
00:04:36,399 --> 00:04:38,560
然后q跟w q相乘

132
00:04:38,959 --> 00:04:40,719
也会得到一个常为h的向量

133
00:04:40,839 --> 00:04:41,920
我把它加起来

134
00:04:42,199 --> 00:04:43,560
加起来放到一个激活海

135
00:04:43,560 --> 00:04:44,680
就是time h里面

136
00:04:45,480 --> 00:04:48,000
会成为一个常为h的向量

137
00:04:48,000 --> 00:04:48,519
对吧

138
00:04:48,519 --> 00:04:50,879
然后在v转制给它成

139
00:04:50,879 --> 00:04:52,359
就变成了一个值

140
00:04:53,399 --> 00:04:53,719
OK

141
00:04:53,719 --> 00:04:56,959
这就是加性的注意力

142
00:04:57,639 --> 00:04:58,680
它等价是干嘛

143
00:04:59,039 --> 00:05:00,479
等价也是个很简单的事情

144
00:05:00,479 --> 00:05:00,879
对吧

145
00:05:00,919 --> 00:05:02,479
等价于你把key

146
00:05:02,919 --> 00:05:03,479
那个向量

147
00:05:03,680 --> 00:05:04,959
就常为k的向量

148
00:05:04,959 --> 00:05:05,799
和你value

149
00:05:11,159 --> 00:05:11,639
不不不

150
00:05:12,199 --> 00:05:12,639
我写错了

151
00:05:12,639 --> 00:05:14,799
就等价于加query和key

152
00:05:15,079 --> 00:05:16,759
query是一个常为k的东西

153
00:05:16,959 --> 00:05:17,519
你的

154
00:05:19,039 --> 00:05:21,000
key也是一个常为一个

155
00:05:22,599 --> 00:05:22,839
不

156
00:05:22,839 --> 00:05:24,039
query是常为

157
00:05:25,120 --> 00:05:25,800
q的东西

158
00:05:25,800 --> 00:05:27,560
key是常为k的东西

159
00:05:27,800 --> 00:05:29,360
这两个东西并在一起

160
00:05:29,399 --> 00:05:30,719
变成了一个

161
00:05:30,719 --> 00:05:33,159
常为k加q的一个向量

162
00:05:33,279 --> 00:05:36,519
然后丢到一个隐藏层大小为h

163
00:05:36,560 --> 00:05:40,039
输出为1的一个单隐藏层mlp

164
00:05:40,159 --> 00:05:41,719
这个东西就是一个mlp

165
00:05:41,719 --> 00:05:42,000
对吧

166
00:05:42,000 --> 00:05:43,399
一个单隐藏的mlp

167
00:05:43,399 --> 00:05:44,800
这个是低层

168
00:05:44,960 --> 00:05:47,520
但是隐藏层它输出是h

169
00:05:47,560 --> 00:05:49,319
然后最后一层输出是e

170
00:05:49,360 --> 00:05:52,680
这是一个单隐藏层的回归

171
00:05:52,680 --> 00:05:53,160
对吧

172
00:05:54,560 --> 00:05:56,240
所以说白了

173
00:05:56,360 --> 00:05:57,480
你的加性attachment

174
00:05:57,480 --> 00:05:58,360
就是把它

175
00:05:58,920 --> 00:06:00,040
key和

176
00:06:00,759 --> 00:06:01,720
query并起来

177
00:06:01,720 --> 00:06:03,439
放到一个单隐藏层的东西出来

178
00:06:03,439 --> 00:06:05,319
然后得到一个输出就行了

179
00:06:05,639 --> 00:06:05,800
好

180
00:06:05,840 --> 00:06:07,560
所以这个就是它的做法

181
00:06:07,680 --> 00:06:08,480
它的好处是什么

182
00:06:08,600 --> 00:06:09,319
它的好处是说

183
00:06:09,319 --> 00:06:11,439
你的key value

184
00:06:11,560 --> 00:06:12,080
这个东西

185
00:06:12,240 --> 00:06:14,080
就可以是任意的长度

186
00:06:14,079 --> 00:06:16,039
就是说你可以这三个之间

187
00:06:16,039 --> 00:06:16,959
可以长得不一样

188
00:06:16,959 --> 00:06:18,199
这个是没关系的

189
00:06:19,000 --> 00:06:21,000
这个也是当你不一样的时候

190
00:06:21,000 --> 00:06:22,519
最常用的一种做法

191
00:06:23,719 --> 00:06:24,680
如果

192
00:06:26,120 --> 00:06:27,800
如果你的query和key

193
00:06:28,240 --> 00:06:30,439
都是同样长度的

194
00:06:31,159 --> 00:06:32,000
你要怎么办

195
00:06:32,560 --> 00:06:34,319
假设我是q和ki

196
00:06:34,319 --> 00:06:36,479
都是一个常为d的一个向量

197
00:06:37,159 --> 00:06:40,159
那么我可以做一个最简单的方法

198
00:06:40,159 --> 00:06:42,360
就是说我就不学东西了

199
00:06:42,600 --> 00:06:46,040
我就直接q和ki做类积

200
00:06:46,840 --> 00:06:48,480
然后除以根号d

201
00:06:48,480 --> 00:06:49,160
除以根号d

202
00:06:49,160 --> 00:06:50,960
就是说使得你

203
00:06:51,120 --> 00:06:54,319
就是说相对对参数没那么敏感一点

204
00:06:54,520 --> 00:06:55,600
就是说如果下一次

205
00:06:55,600 --> 00:06:57,240
我的东西比较长的时候

206
00:06:57,240 --> 00:06:59,240
那所谓的a来的东西都变得比较大

207
00:06:59,280 --> 00:07:01,319
所以我除以d之后

208
00:07:01,319 --> 00:07:03,240
就是说我这样对你的

209
00:07:03,720 --> 00:07:06,160
k那个长度就没那么敏感一点

210
00:07:06,199 --> 00:07:07,240
所以就要做

211
00:07:08,480 --> 00:07:09,439
点击

212
00:07:09,439 --> 00:07:12,920
然后是被重新调过scale的

213
00:07:12,920 --> 00:07:15,360
一个点击的一个注意力提示

214
00:07:16,040 --> 00:07:18,560
这也是最简单的一个版本

215
00:07:20,480 --> 00:07:21,480
它的向量化版本

216
00:07:21,480 --> 00:07:23,439
当然是说假设我有

217
00:07:24,319 --> 00:07:26,480
n个query

218
00:07:26,879 --> 00:07:28,959
我有m个key和value

219
00:07:30,560 --> 00:07:31,759
这东西我们会经常看见

220
00:07:31,879 --> 00:07:33,279
就是之后会给大家绕一点

221
00:07:33,319 --> 00:07:34,319
就是说我的key

222
00:07:34,480 --> 00:07:35,680
就会有多个

223
00:07:35,839 --> 00:07:37,439
我的key value也会多个

224
00:07:37,439 --> 00:07:39,199
所以我就对每一个key

225
00:07:39,199 --> 00:07:40,800
对那个value去做计算

226
00:07:40,800 --> 00:07:41,279
对吧

227
00:07:41,480 --> 00:07:46,719
所以你的aqk就等于q乘以k的转制

228
00:07:46,719 --> 00:07:47,759
再除以d

229
00:07:47,879 --> 00:07:50,920
它是一个n乘以m的矩阵

230
00:07:52,639 --> 00:07:55,000
其中每一行就表示

231
00:07:55,000 --> 00:07:56,879
第第i行就表示

232
00:07:56,879 --> 00:07:58,000
第i个query

233
00:07:58,000 --> 00:07:59,680
它里面权重什么样子

234
00:08:01,199 --> 00:08:01,639
OK

235
00:08:01,639 --> 00:08:03,040
然后你做softmax的话

236
00:08:03,040 --> 00:08:05,279
就是对每一行做softmax

237
00:08:05,639 --> 00:08:06,480
做完之后

238
00:08:06,480 --> 00:08:08,160
你再跟v去乘

239
00:08:09,080 --> 00:08:10,759
那么它就会变成一个

240
00:08:11,400 --> 00:08:13,480
因为就是n乘m的东西

241
00:08:13,560 --> 00:08:14,600
这是个n乘m的东西

242
00:08:14,600 --> 00:08:17,040
v就是一个m乘v的东西

243
00:08:17,040 --> 00:08:19,480
它会得出一个n乘v的东西出来

244
00:08:19,520 --> 00:08:21,200
所以这个东西就是你的权重

245
00:08:21,360 --> 00:08:22,520
这个东西是你的

246
00:08:22,560 --> 00:08:23,080
v

247
00:08:23,560 --> 00:08:24,879
所以最后你的结果是说

248
00:08:24,879 --> 00:08:26,319
对每一个key

249
00:08:26,600 --> 00:08:27,439
因为n个key

250
00:08:27,879 --> 00:08:29,240
会得出一个

251
00:08:29,280 --> 00:08:30,920
每个key会拿回一个

252
00:08:30,920 --> 00:08:32,080
乘以v的一个向量

253
00:08:32,080 --> 00:08:33,200
所以你最后的结果

254
00:08:33,200 --> 00:08:35,039
是一个n乘v的东西

255
00:08:36,039 --> 00:08:36,480
OK

256
00:08:36,480 --> 00:08:38,120
就是说怎么样把这个东西

257
00:08:38,159 --> 00:08:39,759
拓展到多维

258
00:08:40,000 --> 00:08:42,120
当然把之前那个东西拓展多维

259
00:08:42,120 --> 00:08:43,279
更加复杂一点

260
00:08:43,279 --> 00:08:45,839
我们会在代码给大家讲一讲

261
00:08:45,839 --> 00:08:47,360
怎么样把前面那个东西

262
00:08:47,399 --> 00:08:48,719
也拓展到多维

263
00:08:49,559 --> 00:08:50,120
OK

264
00:08:52,039 --> 00:08:53,039
总结一下

265
00:08:53,959 --> 00:08:55,719
总结一下就是说

266
00:08:55,759 --> 00:08:56,799
注意力分数

267
00:08:56,959 --> 00:08:57,919
就是score

268
00:08:58,039 --> 00:09:00,360
就是query和key的一个相似度

269
00:09:01,319 --> 00:09:02,639
相似度就是说

270
00:09:02,879 --> 00:09:03,879
之所以叫相似度

271
00:09:03,879 --> 00:09:04,679
是因为

272
00:09:05,439 --> 00:09:07,679
它是没有被normalized过的

273
00:09:08,399 --> 00:09:09,320
注意力权重

274
00:09:09,439 --> 00:09:12,480
就是对分数做softmax的结果

275
00:09:13,360 --> 00:09:13,679
OK

276
00:09:13,679 --> 00:09:14,000
就是说

277
00:09:14,000 --> 00:09:15,240
使得你这样子权重

278
00:09:15,240 --> 00:09:16,919
是在0到1之间

279
00:09:16,919 --> 00:09:18,159
然后加起来是等于1

280
00:09:18,159 --> 00:09:19,679
这样子是softmax

281
00:09:19,679 --> 00:09:20,679
当然是一个很好的东西

282
00:09:20,679 --> 00:09:21,159
对吧

283
00:09:21,200 --> 00:09:21,879
这样子的话

284
00:09:21,879 --> 00:09:24,279
就不会让你变得值特别大

285
00:09:24,320 --> 00:09:24,879
特别小

286
00:09:26,159 --> 00:09:28,840
所以两个常见的

287
00:09:29,399 --> 00:09:30,480
注意力分数的计算

288
00:09:30,679 --> 00:09:31,720
第一个是说

289
00:09:31,720 --> 00:09:33,639
把query和key合并起来

290
00:09:33,639 --> 00:09:35,120
放到一个单输出的

291
00:09:35,120 --> 00:09:36,799
单影长程的MLP里面

292
00:09:37,759 --> 00:09:38,919
第二个就更简单

293
00:09:38,960 --> 00:09:40,960
如果你的query和key的长度

294
00:09:40,960 --> 00:09:41,639
是一样的话

295
00:09:41,960 --> 00:09:43,080
我就直接做累积

296
00:09:43,080 --> 00:09:44,799
我就不要学什么参数了

297
00:09:45,679 --> 00:09:46,519
当然最简单

298
00:09:46,519 --> 00:09:48,120
如果你是退化到

299
00:09:48,159 --> 00:09:49,199
EV的时候

300
00:09:49,199 --> 00:09:49,720
EV的时候

301
00:09:49,720 --> 00:09:50,319
就会退化到

302
00:09:50,319 --> 00:09:51,360
我们刚刚讲过的

303
00:09:51,919 --> 00:09:56,120
就是说我就key减去你的query

304
00:09:56,120 --> 00:09:57,559
然后平放一下

305
00:09:57,559 --> 00:09:58,159
取个负号

306
00:09:58,159 --> 00:09:58,759
然后数个2

307
00:09:58,759 --> 00:10:01,159
就是最简单的一个计算

308
00:10:01,200 --> 00:10:02,439
如果你想学的话

309
00:10:02,760 --> 00:10:05,720
我可以做一个线性回归

310
00:10:05,880 --> 00:10:07,200
没有影长程的线性回归

311
00:10:07,200 --> 00:10:09,280
就是学一个单w出来

312
00:10:09,280 --> 00:10:09,720
对吧

313
00:10:10,560 --> 00:10:11,080
OK

314
00:10:11,120 --> 00:10:12,360
所以只是说

315
00:10:12,640 --> 00:10:13,400
这两个东西

316
00:10:13,520 --> 00:10:14,720
就有点像是

317
00:10:14,760 --> 00:10:16,760
把刚刚我们单位的版本

318
00:10:17,000 --> 00:10:18,160
拓展到多位

319
00:10:18,160 --> 00:10:19,440
所以一个是有参的

320
00:10:19,440 --> 00:10:20,600
一个是没参的版本

321
00:10:21,120 --> 00:10:23,960
这两个都是在目前注意力

322
00:10:24,080 --> 00:10:24,840
tension里面

323
00:10:24,840 --> 00:10:27,600
最常见的两个做法

324
00:10:28,240 --> 00:10:29,200
所以有了

325
00:10:29,200 --> 00:10:31,720
基本上讲完分数怎么算之后

326
00:10:31,800 --> 00:10:32,800
我们就基本知道

327
00:10:32,800 --> 00:10:34,320
tension是长什么样了

328
00:10:34,360 --> 00:10:35,480
我们接下来

329
00:10:35,480 --> 00:10:36,759
就会给大家来讲

330
00:10:36,759 --> 00:10:37,720
说怎么用它

331
00:10:37,720 --> 00:10:39,720
来改进我们之前的网络

332
00:10:40,360 --> 00:10:41,279
当然在讲之前

333
00:10:41,279 --> 00:10:42,840
我们先来讲一下

334
00:10:42,840 --> 00:10:44,200
它的实现

