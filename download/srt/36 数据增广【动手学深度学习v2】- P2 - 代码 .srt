1
00:00:00,000 --> 00:00:05,280
OK 我们先来讲图片增广或者叫数据增广

2
00:00:05,280 --> 00:00:06,719
数据增广的话

3
00:00:06,719 --> 00:00:09,240
意味着说你不仅仅是处理图片

4
00:00:09,240 --> 00:00:11,120
你可以处理文本也行

5
00:00:11,120 --> 00:00:11,919
或者语音

6
00:00:11,919 --> 00:00:18,640
我们在这里其实主要专注的是图片上的一些基础

7
00:00:19,160 --> 00:00:22,440
可以看到几张图是说你对一张图片

8
00:00:22,640 --> 00:00:25,839
这个是一个松鼠还是一个什么老鼠

9
00:00:26,039 --> 00:00:29,560
然后对它的图片可以做不同的一些处理

10
00:00:29,680 --> 00:00:32,280
比如说一个是你把一些像素拿掉

11
00:00:32,320 --> 00:00:35,600
下面一个是说对它的颜色做变换

12
00:00:35,800 --> 00:00:39,040
然后最后面一个是对它的亮度做很多变换

13
00:00:39,719 --> 00:00:40,359
OK

14
00:00:41,120 --> 00:00:44,320
所以我们从一个真实的故事开始

15
00:00:45,560 --> 00:00:49,000
在这个是两年前的一个真实的故事

16
00:00:49,000 --> 00:00:57,520
在CES应该是消费者电气展上面

17
00:00:58,160 --> 00:01:02,920
有一家做其实国内的做智能售货机的公司

18
00:01:02,920 --> 00:01:05,640
就大家知道在三四年前

19
00:01:05,640 --> 00:01:09,159
Amazon go就是无人售货出来之后特别火

20
00:01:09,320 --> 00:01:11,200
所以大家纷纷去做这一块

21
00:01:11,400 --> 00:01:14,560
智能售货就是说我放一个东西在那里

22
00:01:14,800 --> 00:01:15,920
你用户可以拿

23
00:01:16,320 --> 00:01:18,200
比如说卖可乐卖什么

24
00:01:18,200 --> 00:01:19,400
你拿走之后

25
00:01:19,600 --> 00:01:23,240
我通过摄像头对你的人脸进行识别

26
00:01:23,280 --> 00:01:27,359
然后去检测是谁拿了什么

27
00:01:27,359 --> 00:01:28,640
然后对你来计价

28
00:01:30,040 --> 00:01:33,920
然后一家这样子做智能售货的公司

29
00:01:33,920 --> 00:01:37,840
在CES上做demo的时候发现效果很差

30
00:01:38,400 --> 00:01:42,680
就是我在公司里面跑的好好的demo

31
00:01:42,680 --> 00:01:46,079
我运到CES是在美国的拉斯维加斯

32
00:01:46,079 --> 00:01:48,439
为了运到拉斯维加斯之后

33
00:01:48,480 --> 00:01:50,239
怎么效果就没了

34
00:01:51,039 --> 00:01:54,000
然后工程师就去看为什么

35
00:01:54,159 --> 00:01:56,200
后来发现有两个主要的原因

36
00:01:56,480 --> 00:02:01,719
一个是说在CES拉斯维加斯的场馆里面

37
00:02:01,879 --> 00:02:05,359
大家知道赌城的灯我去过几次

38
00:02:05,400 --> 00:02:09,319
他们那些场所的灯都很暗

39
00:02:09,560 --> 00:02:11,080
而且偏黄我觉得

40
00:02:11,840 --> 00:02:14,759
所以是说整个色温就不对

41
00:02:15,360 --> 00:02:19,680
你在可能是一个很黄就很暖的一个色温下面

42
00:02:20,400 --> 00:02:22,879
然后可能你在自己做的时候

43
00:02:22,879 --> 00:02:23,920
在自己做demo的时候

44
00:02:23,920 --> 00:02:25,800
你是一个正常的办公室场所

45
00:02:25,840 --> 00:02:27,360
你的色温可能是比较

46
00:02:29,240 --> 00:02:30,439
比如说是5000k

47
00:02:30,800 --> 00:02:33,160
然后你到了场馆就可能变成3000k了

48
00:02:34,360 --> 00:02:37,760
色温导致说你效果会变差很多

49
00:02:38,280 --> 00:02:42,920
第二个是说他们把机器放在一个桌子上面做demo

50
00:02:43,920 --> 00:02:46,920
桌子是一个很亮的一个平面

51
00:02:46,960 --> 00:02:48,720
然后你的灯光射过来

52
00:02:48,720 --> 00:02:50,040
然后反射上去

53
00:02:50,640 --> 00:02:52,720
然后灯光的桌面的反射

54
00:02:52,719 --> 00:02:57,199
导致了你的整个颜色

55
00:02:57,319 --> 00:02:59,719
整个图片的虚景就发生了变化

56
00:03:00,319 --> 00:03:01,360
所以他们怎么解决

57
00:03:01,479 --> 00:03:03,639
还好是说他们在开场前

58
00:03:03,840 --> 00:03:05,479
前一天他们去测试的时候

59
00:03:05,479 --> 00:03:07,280
去setup的时候发现有问题

60
00:03:07,639 --> 00:03:09,400
当天晚上发现了问题

61
00:03:09,439 --> 00:03:12,759
赶紧连夜在现场采集了一堆数据

62
00:03:13,000 --> 00:03:14,400
然后发回国

63
00:03:14,560 --> 00:03:16,879
国内的工程师连夜训练

64
00:03:17,120 --> 00:03:18,680
再训练了一个新的模型

65
00:03:19,159 --> 00:03:21,159
这样子解决了色温的问题

66
00:03:21,759 --> 00:03:23,079
第二个问题是说

67
00:03:23,079 --> 00:03:25,359
他们就出门去买了一块桌布

68
00:03:25,799 --> 00:03:27,520
买个桌布铺在桌子上

69
00:03:27,840 --> 00:03:28,840
就没有反光了

70
00:03:29,039 --> 00:03:30,039
解决另外一个问题

71
00:03:31,079 --> 00:03:35,519
所以它不是一个很不常见的问题

72
00:03:35,680 --> 00:03:36,639
这个问题就是说

73
00:03:36,680 --> 00:03:39,359
你在采集数据训练模型的时候

74
00:03:39,359 --> 00:03:40,840
你的场景是这样子

75
00:03:40,960 --> 00:03:42,519
但是你在实际部署的时候

76
00:03:42,519 --> 00:03:43,639
可能会很不一样

77
00:03:43,960 --> 00:03:45,359
这一块特别是对于

78
00:03:45,800 --> 00:03:47,120
比如说手机上的应用

79
00:03:47,599 --> 00:03:49,639
各种摄像头那一块的应用

80
00:03:49,680 --> 00:03:50,960
确实是非常不一样

81
00:03:51,439 --> 00:03:52,960
不管是比如说语音识别

82
00:03:53,159 --> 00:03:55,079
语音识别说我在室内识别

83
00:03:55,079 --> 00:03:56,599
我在室外识别

84
00:03:56,599 --> 00:03:57,479
我在什么样的地方

85
00:03:57,520 --> 00:03:59,519
就整个背景噪音是不一样的

86
00:03:59,519 --> 00:04:01,240
还是声音的反射也不一样

87
00:04:01,840 --> 00:04:03,639
摄像头也是一样的

88
00:04:04,039 --> 00:04:05,479
你手机拍的东西

89
00:04:05,519 --> 00:04:08,159
你的摄像头的质量不一样

90
00:04:08,400 --> 00:04:09,439
颜色不一样

91
00:04:09,840 --> 00:04:10,719
场景不一样

92
00:04:10,719 --> 00:04:12,079
都会给你导致问题

93
00:04:12,960 --> 00:04:14,919
所以就是说

94
00:04:15,039 --> 00:04:18,800
你在训练级能够尽可能的去模拟

95
00:04:18,800 --> 00:04:20,319
你在部署的时候

96
00:04:20,319 --> 00:04:21,759
可以碰到的各种场景

97
00:04:21,800 --> 00:04:23,560
是你能够模型的

98
00:04:23,599 --> 00:04:26,279
泛化性的一个非常重要的部分

99
00:04:27,680 --> 00:04:29,360
所以数据增强是干嘛

100
00:04:30,599 --> 00:04:32,480
数据增强的意思是说

101
00:04:33,600 --> 00:04:35,879
在一个已有的数据集上面

102
00:04:37,000 --> 00:04:40,639
我通过对他的数据进行变换

103
00:04:40,639 --> 00:04:42,680
使得他有更多的多样性

104
00:04:43,199 --> 00:04:45,319
比如说你是语音的数据的话

105
00:04:45,360 --> 00:04:46,719
那么我可以在语音里面

106
00:04:46,719 --> 00:04:48,519
加入不同的背景噪音

107
00:04:49,439 --> 00:04:51,199
如果是图片数据的话

108
00:04:51,240 --> 00:04:53,680
那么我可以去改变图片的形状

109
00:04:54,319 --> 00:04:54,879
颜色

110
00:04:55,639 --> 00:04:57,799
比如说这里的话

111
00:04:58,319 --> 00:05:00,560
这是原始的一张猫的图片

112
00:05:00,799 --> 00:05:02,120
这是数据集里面的

113
00:05:02,159 --> 00:05:02,799
比如说

114
00:05:03,959 --> 00:05:04,439
我们干嘛

115
00:05:04,639 --> 00:05:05,639
这一块就是说

116
00:05:05,639 --> 00:05:08,599
把整个图片你抠出一块来

117
00:05:09,399 --> 00:05:10,240
就是说因为你

118
00:05:10,279 --> 00:05:11,959
虽然我这个地方拍的比较好

119
00:05:12,039 --> 00:05:13,359
整个猫都拍过来了

120
00:05:13,599 --> 00:05:15,120
那么在实际中

121
00:05:15,120 --> 00:05:18,319
可能你可能只拍到一个猫的一半

122
00:05:18,439 --> 00:05:20,240
那么你也有看到它的时候

123
00:05:20,240 --> 00:05:21,680
你应该也能去识别出

124
00:05:21,719 --> 00:05:22,599
这是一只猫

125
00:05:23,480 --> 00:05:24,240
第二块就是说

126
00:05:24,240 --> 00:05:26,360
我可以对图片的亮度进行变化

127
00:05:26,360 --> 00:05:27,319
有可能是比较暗

128
00:05:27,319 --> 00:05:28,279
有可能是比较亮

129
00:05:28,920 --> 00:05:29,680
第三个是说

130
00:05:29,680 --> 00:05:31,519
我可以对它的色温进行变化

131
00:05:31,719 --> 00:05:32,839
可以是蓝一点

132
00:05:32,839 --> 00:05:34,759
红一点

133
00:05:35,639 --> 00:05:36,240
OK

134
00:05:37,159 --> 00:05:38,319
然后就是说

135
00:05:38,639 --> 00:05:40,560
一般来说用的时候

136
00:05:40,560 --> 00:05:43,279
它是说你是在线生成的

137
00:05:44,039 --> 00:05:46,079
你不是说我给一个数据集

138
00:05:46,199 --> 00:05:47,399
我给你生成好图片

139
00:05:47,400 --> 00:05:48,360
然后存下来

140
00:05:48,560 --> 00:05:50,000
一般的做法是说

141
00:05:50,000 --> 00:05:51,520
我还是跟以前一样

142
00:05:51,680 --> 00:05:53,720
去从原始数据读图片

143
00:05:55,200 --> 00:05:56,480
读过来之后

144
00:05:56,800 --> 00:05:59,720
一般的做法是随机的做增强

145
00:06:01,080 --> 00:06:03,840
就是说我从数据去读出来之后

146
00:06:03,840 --> 00:06:07,360
然后将我的一些不同的增强的方法

147
00:06:07,800 --> 00:06:09,600
随机的应用在图片上

148
00:06:09,880 --> 00:06:10,640
就可以生出

149
00:06:11,080 --> 00:06:13,600
可能是生出来一堆不一样的图片

150
00:06:13,960 --> 00:06:16,440
然后对它再进入我们的模型

151
00:06:16,440 --> 00:06:17,240
进行训练

152
00:06:17,880 --> 00:06:19,160
所以核心是说

153
00:06:19,160 --> 00:06:22,160
你每一次是在线的生成

154
00:06:22,320 --> 00:06:24,680
而且是可能是随机的

155
00:06:26,200 --> 00:06:27,560
然后当然是说

156
00:06:27,840 --> 00:06:28,880
这个是训练的时候

157
00:06:29,120 --> 00:06:30,320
这测试的时候

158
00:06:30,320 --> 00:06:32,760
我们一般是不会去进行图片增强的

159
00:06:33,400 --> 00:06:34,440
这个也就是

160
00:06:34,440 --> 00:06:35,280
所以你可以认为

161
00:06:35,280 --> 00:06:38,920
它也算是一个正则项

162
00:06:39,240 --> 00:06:41,280
只是作用在训练的时候

163
00:06:43,720 --> 00:06:45,680
所以我们给几个例子来讲

164
00:06:45,680 --> 00:06:48,360
看它的常见的一些数据增强

165
00:06:48,360 --> 00:06:49,360
是长什么样子的

166
00:06:50,160 --> 00:06:53,280
比如说这个是左右翻转

167
00:06:53,280 --> 00:06:54,319
给一张图片

168
00:06:54,680 --> 00:06:56,439
我把你左右翻转一下

169
00:06:57,199 --> 00:06:58,040
这个是

170
00:06:58,400 --> 00:07:00,120
当然你可以上下翻转

171
00:07:01,360 --> 00:07:03,600
你比如说上下flip一下

172
00:07:04,280 --> 00:07:06,240
当然是说你上下翻转

173
00:07:06,240 --> 00:07:07,920
不是永远都是行的

174
00:07:08,360 --> 00:07:10,079
比如说你这只猫

175
00:07:10,360 --> 00:07:11,800
你翻转过之后

176
00:07:11,800 --> 00:07:12,639
你头向下

177
00:07:12,639 --> 00:07:14,360
就是一个很奇怪的现象了

178
00:07:14,680 --> 00:07:17,360
假设你的图片是一个建筑的图片

179
00:07:17,720 --> 00:07:19,080
然后你把它翻一下

180
00:07:19,080 --> 00:07:19,759
你就很奇怪

181
00:07:19,800 --> 00:07:20,240
对吧

182
00:07:20,480 --> 00:07:25,360
所以上下翻转是取决于你的数据级的样子

183
00:07:25,520 --> 00:07:28,800
比如说我们这一次的数页分类

184
00:07:28,840 --> 00:07:30,480
你可以使用上下翻转

185
00:07:31,480 --> 00:07:31,920
OK

186
00:07:33,759 --> 00:07:35,720
第二种是说切割

187
00:07:36,680 --> 00:07:38,360
就是说一般的做法是说

188
00:07:38,360 --> 00:07:40,400
我在一张图片里面

189
00:07:41,160 --> 00:07:42,720
切割出一块出来

190
00:07:43,480 --> 00:07:46,240
然后再把它变成一个固定的形状

191
00:07:46,760 --> 00:07:47,960
为什么变固定形状

192
00:07:47,960 --> 00:07:50,000
是因为你的卷积神经网络

193
00:07:50,000 --> 00:07:51,880
我们通常是一个固定的输入

194
00:07:52,240 --> 00:07:55,440
我们知道我们一般是用224×224

195
00:07:56,200 --> 00:07:58,400
这个也是因为ImageNet

196
00:07:58,800 --> 00:08:00,840
长得比较像是224×224

197
00:08:03,800 --> 00:08:05,520
然后一般的做法是说

198
00:08:05,800 --> 00:08:07,680
你怎么样去切那一块

199
00:08:08,400 --> 00:08:09,440
一般的做法是说

200
00:08:09,440 --> 00:08:11,680
我可以做一个随机的高宽比

201
00:08:12,319 --> 00:08:16,920
就是说我可以在3Ⅳ到4Ⅲ之间

202
00:08:16,920 --> 00:08:18,360
随机取一个数

203
00:08:19,000 --> 00:08:23,280
这个数就是你的切的地方的高宽比

204
00:08:25,280 --> 00:08:26,680
然后另外一块就是说

205
00:08:26,680 --> 00:08:30,240
我在比如说8%和100%之间

206
00:08:30,240 --> 00:08:31,480
随机选一个值

207
00:08:32,120 --> 00:08:35,159
这个值是说我切的这一块东西

208
00:08:35,159 --> 00:08:38,399
占原始图片里面的百分之多少

209
00:08:39,240 --> 00:08:40,879
8%其实是个很小的东西

210
00:08:41,399 --> 00:08:43,759
8%可能就是那么小一块就切出来了

211
00:08:44,639 --> 00:08:46,519
百分百的话当然是原始的图片了

212
00:08:47,439 --> 00:08:51,559
第三个是说我可以在随机的一个位置

213
00:08:51,559 --> 00:08:55,720
我可以给定我一个块的大小的话

214
00:08:55,720 --> 00:08:58,679
我可以在图片之随机一个位置进行切割

215
00:08:59,519 --> 00:09:01,360
所以你能看到是说

216
00:09:01,679 --> 00:09:04,279
比如说这个地方这种图片是哪里切的

217
00:09:04,279 --> 00:09:05,759
这个图片应该是在这个地方切的

218
00:09:05,759 --> 00:09:06,159
对吧

219
00:09:06,480 --> 00:09:08,840
然后这个是一个很奇怪

220
00:09:08,840 --> 00:09:09,679
切在这个地方

221
00:09:10,360 --> 00:09:13,600
这个毛其实就是切了一块比较大的了

222
00:09:14,240 --> 00:09:16,240
就切了一块这样子比较大的图片出来

223
00:09:17,400 --> 00:09:17,760
OK

224
00:09:18,280 --> 00:09:21,360
这就是随机的切割

225
00:09:22,920 --> 00:09:24,200
而且所谓的随机性

226
00:09:24,200 --> 00:09:28,640
就是说每一次对我的一个读出来的一个图片

227
00:09:29,160 --> 00:09:30,160
做切割的时候

228
00:09:30,160 --> 00:09:34,000
我的那些区域的值都是在里面随机取的

229
00:09:34,520 --> 00:09:35,920
这是三个随机性在里面

230
00:09:35,919 --> 00:09:40,120
另外一个是颜色

231
00:09:41,279 --> 00:09:42,319
颜色的话

232
00:09:42,319 --> 00:09:45,439
就是说我们知道色调

233
00:09:46,120 --> 00:09:47,679
饱和度和明亮度

234
00:09:47,679 --> 00:09:49,000
就三个比较重要的东西

235
00:09:49,000 --> 00:09:51,000
色调就是说你的颜色

236
00:09:51,399 --> 00:09:53,519
你是黄一点的

237
00:09:53,519 --> 00:09:54,159
红一点的

238
00:09:54,159 --> 00:09:54,919
蓝一点的

239
00:09:55,360 --> 00:09:58,759
饱和度就是说你从你的浓度

240
00:09:58,759 --> 00:10:01,039
饱和度可以认为是你的浓度

241
00:10:01,719 --> 00:10:03,919
然后你的明亮度就是你的亮度

242
00:10:04,919 --> 00:10:05,399
OK

243
00:10:05,399 --> 00:10:07,719
这个是比如说这个是明亮度

244
00:10:08,240 --> 00:10:09,159
这个是色调

245
00:10:09,159 --> 00:10:09,879
一般来说

246
00:10:09,879 --> 00:10:12,000
你是取的是当前值

247
00:10:12,919 --> 00:10:16,000
它要么是说我在0.5到1.5之间

248
00:10:16,000 --> 00:10:17,120
随机取一个值

249
00:10:17,559 --> 00:10:19,719
那么在当前值上面作用

250
00:10:19,719 --> 00:10:20,839
对它进行作用

251
00:10:20,839 --> 00:10:22,439
当前值就认为是1.0

252
00:10:23,000 --> 00:10:25,839
就是说我要么就可以把明亮度往下减

253
00:10:25,839 --> 00:10:27,199
可能减到50%

254
00:10:27,199 --> 00:10:29,000
要么就再增加50%

255
00:10:30,439 --> 00:10:30,799
OK

256
00:10:30,800 --> 00:10:34,280
这就是常用一点的

257
00:10:35,360 --> 00:10:36,160
实际上来说

258
00:10:36,160 --> 00:10:38,080
你可以有很多种办法

259
00:10:38,880 --> 00:10:40,160
这个是一个叫做

260
00:10:41,520 --> 00:10:44,160
image.org的一个repo

261
00:10:44,760 --> 00:10:46,760
这里面提供了大概几十种

262
00:10:46,760 --> 00:10:49,480
不一样的做图片增强的方法

263
00:10:50,000 --> 00:10:52,120
可以看到比如说取高速模糊

264
00:10:53,280 --> 00:10:56,440
然后把里面一些块设成黑

265
00:10:57,160 --> 00:10:58,720
然后整个图片做变形了

266
00:10:58,720 --> 00:10:59,960
你看这个地方做变形了

267
00:10:59,960 --> 00:11:01,800
就是说做一个很奇怪的变形

268
00:11:01,800 --> 00:11:03,879
然后这个应该是锐化

269
00:11:05,680 --> 00:11:07,320
你基本上可以认为是说

270
00:11:07,320 --> 00:11:09,400
你photoshop能够干的事情

271
00:11:09,639 --> 00:11:11,680
photoshop能够帮你做各种奇奇怪怪的

272
00:11:11,680 --> 00:11:12,960
filter做变换

273
00:11:13,560 --> 00:11:15,040
photoshop能够提供的东西

274
00:11:15,040 --> 00:11:17,680
你都可以把它做在图片上面

275
00:11:18,960 --> 00:11:19,440
对吧

276
00:11:19,840 --> 00:11:20,879
但实际上来说

277
00:11:20,879 --> 00:11:23,759
你可能作用好不好就不知道了

278
00:11:24,519 --> 00:11:25,360
比如说

279
00:11:27,160 --> 00:11:28,960
你说这种这样子的效果

280
00:11:29,000 --> 00:11:31,680
就是说你觉得它有用

281
00:11:31,680 --> 00:11:33,080
很多时候是因为你觉得

282
00:11:33,080 --> 00:11:35,560
你的测试集里面会有图片

283
00:11:35,840 --> 00:11:37,400
跟这个效果是差不多的

284
00:11:37,840 --> 00:11:38,400
但反过来讲

285
00:11:38,400 --> 00:11:40,759
如果你觉得你的测试集相对来说

286
00:11:40,759 --> 00:11:42,519
或者你部署的是环境

287
00:11:42,519 --> 00:11:44,360
不会给你带来那么奇怪的结果

288
00:11:44,360 --> 00:11:45,320
你可以不用考虑

289
00:11:45,920 --> 00:11:47,160
所以很多时候你是一个

290
00:11:47,160 --> 00:11:49,400
从后开始往前推

291
00:11:49,639 --> 00:11:51,600
你去想你在部署的时候

292
00:11:51,600 --> 00:11:53,120
和你的测试集的时候

293
00:11:53,120 --> 00:11:55,400
里面的图片里面采到数据

294
00:11:55,400 --> 00:11:56,800
会有什么样子的变化

295
00:11:57,400 --> 00:11:59,320
然后你对从他反推说

296
00:11:59,320 --> 00:12:01,360
你需要什么样子的数据增强

297
00:12:02,320 --> 00:12:02,600
OK

298
00:12:02,600 --> 00:12:04,600
这就是一个很简单的介绍

299
00:12:05,040 --> 00:12:05,760
总结一下

300
00:12:05,760 --> 00:12:06,520
就是说

301
00:12:06,960 --> 00:12:08,320
数据增强

302
00:12:08,520 --> 00:12:12,240
通过对数据变形来获取多样性

303
00:12:13,120 --> 00:12:14,360
当你多样性的话

304
00:12:14,360 --> 00:12:15,240
更好的时候

305
00:12:15,240 --> 00:12:17,600
使得你的模型范化性更好

306
00:12:17,680 --> 00:12:20,800
是因为你希望你对数据变形

307
00:12:20,800 --> 00:12:22,920
使得你能够cover到

308
00:12:22,920 --> 00:12:24,360
在你的测试的时候

309
00:12:24,399 --> 00:12:28,240
你的数据的一些常见的一些情况

310
00:12:29,560 --> 00:12:31,519
在数据增强

311
00:12:31,519 --> 00:12:33,159
当然是可以用在任何数据上面

312
00:12:33,560 --> 00:12:36,039
我们这里介绍的是图片增广

313
00:12:37,720 --> 00:12:39,159
图片增广或增强

314
00:12:39,279 --> 00:12:41,159
就是包括了翻转了

315
00:12:41,200 --> 00:12:42,000
切割了

316
00:12:42,000 --> 00:12:42,720
还变色了

317
00:12:42,720 --> 00:12:44,639
这三种是最常用的

318
00:12:44,840 --> 00:12:48,279
也是我们经常会在实际中用到的

