1
00:00:00,000 --> 00:00:03,560
因为大家知道目标检测数据集

2
00:00:03,560 --> 00:00:05,520
我们刚刚讲到coco这个数据集

3
00:00:05,520 --> 00:00:06,719
就目标检测数据集

4
00:00:06,719 --> 00:00:08,359
这个很奇怪的是说

5
00:00:08,359 --> 00:00:12,040
它没有特别好的特别小的数据集

6
00:00:12,679 --> 00:00:15,480
小的数据就mlist就很小了

7
00:00:15,519 --> 00:00:16,800
Sifa也还行

8
00:00:17,320 --> 00:00:19,160
就是说它没有很小的数据集

9
00:00:19,160 --> 00:00:23,000
就是说导致我们在跑起来就很麻烦

10
00:00:23,000 --> 00:00:25,800
就是说你得上一个比较大一点数据集

11
00:00:25,800 --> 00:00:28,080
然后训练起来就特别慢

12
00:00:28,320 --> 00:00:29,600
所以我们为了掩饰

13
00:00:29,679 --> 00:00:33,280
我们手动构造了一个非常小的一个toy

14
00:00:33,280 --> 00:00:33,880
example

15
00:00:34,399 --> 00:00:36,880
就是我们叫做香蕉检测

16
00:00:37,160 --> 00:00:39,320
之前我们其实不叫香蕉检测

17
00:00:39,320 --> 00:00:41,960
之前我们叫比皮卡丘检测

18
00:00:42,679 --> 00:00:43,480
皮卡丘检测

19
00:00:43,480 --> 00:00:45,680
后来我们发现皮卡丘

20
00:00:47,079 --> 00:00:48,200
虽然大家很熟悉

21
00:00:48,320 --> 00:00:50,600
但是它是有版权的

22
00:00:51,040 --> 00:00:52,439
就最好是不要

23
00:00:52,439 --> 00:00:56,880
为了万一我们就没有把皮卡丘换掉

24
00:00:57,840 --> 00:00:59,240
我们买了一个香蕉

25
00:00:59,440 --> 00:01:02,080
香蕉拍一张图片

26
00:01:02,080 --> 00:01:06,799
然后放到一个背景图里面

27
00:01:06,799 --> 00:01:08,799
然后各种地方放一放

28
00:01:09,000 --> 00:01:10,640
就香蕉反正没有版权

29
00:01:10,640 --> 00:01:12,439
所以我们就直接用它了

30
00:01:12,439 --> 00:01:14,120
构造一个这样的数据集出来

31
00:01:15,159 --> 00:01:15,920
给大家看一下

32
00:01:15,920 --> 00:01:16,560
是说

33
00:01:18,280 --> 00:01:20,599
就是说首先我们可以看到

34
00:01:20,599 --> 00:01:22,040
是我们要读取这个数据集

35
00:01:22,359 --> 00:01:27,080
其实我们做最简单的方法

36
00:01:27,080 --> 00:01:28,160
就是说我们先下载

37
00:01:28,360 --> 00:01:29,000
下载

38
00:01:29,000 --> 00:01:29,960
然后解压

39
00:01:30,240 --> 00:01:34,080
接下来我们把 label.csv给你拿出来

40
00:01:34,719 --> 00:01:37,880
CSV它用的格式就跟我们之前差不多

41
00:01:38,200 --> 00:01:41,440
我们讲的一个图片的名字

42
00:01:41,560 --> 00:01:43,760
它每一行是一个物体

43
00:01:44,240 --> 00:01:45,480
然后它的标号

44
00:01:45,480 --> 00:01:46,760
以及它的bounded box

45
00:01:48,080 --> 00:01:50,160
那就是说用pandas把它抖进来之后

46
00:01:50,799 --> 00:01:52,439
然后我们去把

47
00:01:53,519 --> 00:01:56,840
接下来对于每一个里面

48
00:01:56,959 --> 00:01:58,560
每一个image里面

49
00:01:58,560 --> 00:01:59,399
我们去

50
00:01:59,679 --> 00:02:01,840
接下来就是用touch vision的

51
00:02:02,120 --> 00:02:03,280
read image这个文件

52
00:02:03,280 --> 00:02:05,079
把这个图片全部读到内存里面

53
00:02:05,959 --> 00:02:10,199
然后我们就返回我们所有读出来的图片

54
00:02:10,240 --> 00:02:15,719
和我们标号对应的那些tensor返回回去

55
00:02:16,719 --> 00:02:20,240
就这个也是一个相对来说

56
00:02:20,560 --> 00:02:22,439
比较傻一点的做法

57
00:02:22,800 --> 00:02:25,159
因为我们把所有的图片读到内存里面

58
00:02:26,120 --> 00:02:28,599
这是因为这个图片相对比较小

59
00:02:28,599 --> 00:02:31,479
我们就没有用特别好一点的方法

60
00:02:31,479 --> 00:02:33,479
就是说你要用的时候再去读

61
00:02:34,079 --> 00:02:35,240
另外一个是说

62
00:02:35,240 --> 00:02:38,240
我们这里是我们知道这个图片是

63
00:02:38,240 --> 00:02:39,879
它的标号名

64
00:02:40,039 --> 00:02:41,879
这个标号是这么存的

65
00:02:41,919 --> 00:02:44,439
所以我们就直接可以去做这个应用

66
00:02:44,560 --> 00:02:45,840
但实际上来说

67
00:02:45,840 --> 00:02:47,079
对于目标检测来说

68
00:02:47,079 --> 00:02:51,199
大家有一些规范的一些大家一些方法

69
00:02:51,319 --> 00:02:53,280
就比如coco有自己的一个

70
00:02:53,520 --> 00:02:55,560
标号的一个表示方式

71
00:02:55,599 --> 00:02:58,639
然后可能还有应该是有几个

72
00:02:58,800 --> 00:02:59,879
有两个

73
00:02:59,919 --> 00:03:02,919
应该是有两个比较主流的标号表示方式

74
00:03:03,039 --> 00:03:04,800
就是说大家真的要去读的时候

75
00:03:04,800 --> 00:03:05,960
你得去看一下

76
00:03:05,960 --> 00:03:06,639
你那个标号

77
00:03:06,639 --> 00:03:08,919
到底是用什么样格式存起来的

78
00:03:11,840 --> 00:03:13,039
然后接下来就是说

79
00:03:13,039 --> 00:03:16,959
我们就是构造一个自定义的实例了

80
00:03:17,159 --> 00:03:19,879
我们就自定义是在Torch的一个

81
00:03:19,879 --> 00:03:21,919
data set的一个子粒

82
00:03:22,799 --> 00:03:25,359
我们就是用来加载我们要的数据集

83
00:03:25,879 --> 00:03:26,919
就是他init干嘛

84
00:03:27,000 --> 00:03:28,840
init就是把所有的数据读进来

85
00:03:28,959 --> 00:03:30,519
然后说我们读了多个样本

86
00:03:31,199 --> 00:03:32,840
而每一次就是说这个数据集

87
00:03:32,840 --> 00:03:35,599
它只要实现两个含蓄就行了

88
00:03:35,799 --> 00:03:38,959
一个是说我要返回这个数据集有多长

89
00:03:39,680 --> 00:03:40,560
多长的好

90
00:03:40,560 --> 00:03:41,759
就是说你拿到多长

91
00:03:41,759 --> 00:03:43,439
这我就知道一个data epoch

92
00:03:43,439 --> 00:03:44,919
大概会跑多少个

93
00:03:44,919 --> 00:03:46,039
多少轮

94
00:03:46,679 --> 00:03:49,000
接下来是说我给定说

95
00:03:49,000 --> 00:03:50,840
我要读取第一个样本怎么读

96
00:03:52,120 --> 00:03:54,759
第二个样本就是说我们这里就是把

97
00:03:54,759 --> 00:03:56,039
这个features

98
00:03:56,399 --> 00:04:00,759
就是他的第二个图片转成float返回

99
00:04:00,759 --> 00:04:01,319
回去

100
00:04:01,359 --> 00:04:04,120
给他把label转成float返回回去

101
00:04:04,879 --> 00:04:06,199
我们在label很简单

102
00:04:06,239 --> 00:04:08,799
就是说我们都没有物体标号

103
00:04:08,799 --> 00:04:10,479
因为就是一个香蕉

104
00:04:10,480 --> 00:04:11,600
就是单分类问题

105
00:04:12,040 --> 00:04:13,880
单物体的识别是最简单的

106
00:04:13,880 --> 00:04:16,240
所以你都不需要标号的问题

107
00:04:17,720 --> 00:04:18,319
Ok

108
00:04:18,720 --> 00:04:21,520
所以我们就最简单的实例

109
00:04:21,960 --> 00:04:25,360
然后我们当然是说可以加载一个

110
00:04:25,400 --> 00:04:26,920
trend set

111
00:04:27,040 --> 00:04:28,480
我们一个valid set

112
00:04:28,840 --> 00:04:30,319
我们就存在这个地方

113
00:04:30,360 --> 00:04:31,879
然后我们给一个批量大小

114
00:04:32,360 --> 00:04:35,240
所以你的批量大小返回的其实是

115
00:04:36,200 --> 00:04:37,800
我们之后会来给大家讲一下

116
00:04:37,800 --> 00:04:38,879
这个批量大小返回的

117
00:04:38,879 --> 00:04:40,839
跟图片分类会有一点不一样

118
00:04:40,879 --> 00:04:43,000
因为你一个物体

119
00:04:43,719 --> 00:04:48,680
你一个图片里面可能有多个物体

120
00:04:48,680 --> 00:04:49,159
对吧

121
00:04:49,719 --> 00:04:51,079
然后你做批量的时候

122
00:04:51,079 --> 00:04:52,560
你现在图片做

123
00:04:54,040 --> 00:04:55,759
很多时候你现在图片做批量

124
00:04:56,159 --> 00:04:57,319
图片做批量的话

125
00:04:57,319 --> 00:04:59,199
那么你就会有一个说

126
00:04:59,680 --> 00:05:00,399
到底

127
00:05:00,959 --> 00:05:02,319
你有一张图片里面

128
00:05:02,319 --> 00:05:03,159
可能就一个物体

129
00:05:03,159 --> 00:05:04,439
有一张可能有5个

130
00:05:04,439 --> 00:05:05,800
有一张可能有10个

131
00:05:05,800 --> 00:05:06,639
那你怎么办

132
00:05:07,279 --> 00:05:08,039
一般来说

133
00:05:08,039 --> 00:05:10,919
就说我会设一个上限

134
00:05:11,240 --> 00:05:12,039
就是说一个图片

135
00:05:12,039 --> 00:05:14,680
我认为最多有5个类别

136
00:05:14,680 --> 00:05:15,839
有5个物体

137
00:05:16,039 --> 00:05:17,639
或者最多有10个物体

138
00:05:18,039 --> 00:05:19,079
然后如果多了

139
00:05:19,240 --> 00:05:20,680
我就把这个东西丢掉

140
00:05:21,039 --> 00:05:23,360
少了我就填一点零在里面

141
00:05:23,879 --> 00:05:24,240
这样子

142
00:05:24,240 --> 00:05:25,360
我就可以把这个批量

143
00:05:25,360 --> 00:05:27,240
也做成一个规格增长的tensor

144
00:05:27,560 --> 00:05:28,800
就说你的批量

145
00:05:28,800 --> 00:05:30,039
你的标号

146
00:05:30,039 --> 00:05:31,000
其实是

147
00:05:31,039 --> 00:05:34,919
你是一个批量大小

148
00:05:35,319 --> 00:05:36,240
第二位是说

149
00:05:36,240 --> 00:05:37,759
你有多少个物体

150
00:05:37,960 --> 00:05:38,600
要么是5

151
00:05:38,680 --> 00:05:39,319
如果你设成5

152
00:05:39,319 --> 00:05:40,360
就5是上限

153
00:05:40,439 --> 00:05:42,840
接下来就是5个feature

154
00:05:42,879 --> 00:05:44,759
一个可能是你的标号Y

155
00:05:44,800 --> 00:05:46,240
就是你的物体的类别

156
00:05:46,280 --> 00:05:47,560
剩下的4列

157
00:05:47,600 --> 00:05:51,319
分别对是你框的坐标

158
00:05:51,920 --> 00:05:52,280
OK

159
00:05:52,280 --> 00:05:53,639
但这里我们比较简单

160
00:05:53,800 --> 00:05:54,840
我们一张图片里面

161
00:05:54,840 --> 00:05:56,439
就一个橡胶

162
00:05:56,600 --> 00:05:57,960
所以就最简单的

163
00:05:57,960 --> 00:05:59,600
每一张图片就一个物体

164
00:06:02,720 --> 00:06:03,120
OK

165
00:06:03,120 --> 00:06:06,160
然后我们打印一下小批量

166
00:06:06,160 --> 00:06:06,560
看一下

167
00:06:06,720 --> 00:06:07,840
我们就直接说

168
00:06:08,720 --> 00:06:10,840
图片的话跟之前没区别

169
00:06:10,840 --> 00:06:11,600
就是

170
00:06:12,280 --> 00:06:13,360
比如说我们

171
00:06:13,560 --> 00:06:16,280
我们一共就是1000个训练样本

172
00:06:16,399 --> 00:06:17,680
100个测试样本

173
00:06:17,680 --> 00:06:18,720
所以简单

174
00:06:18,800 --> 00:06:22,160
然后我们如果批量大小是32的话

175
00:06:22,280 --> 00:06:24,079
然后我们说图片

176
00:06:24,079 --> 00:06:26,920
我们都是读成都是256的话

177
00:06:27,040 --> 00:06:30,519
那么图片就批量跟之前是一样的

178
00:06:30,519 --> 00:06:31,920
就是batch size

179
00:06:31,920 --> 00:06:33,080
RGB channel

180
00:06:33,199 --> 00:06:34,240
高和宽

181
00:06:35,040 --> 00:06:36,120
另外一个就是说

182
00:06:36,319 --> 00:06:37,400
主要看一下这个地方

183
00:06:38,400 --> 00:06:40,400
这里就是我们之前讲到的

184
00:06:40,520 --> 00:06:41,600
批量大小

185
00:06:41,960 --> 00:06:43,680
每张图片里面

186
00:06:43,680 --> 00:06:45,280
最多有多少个物体

187
00:06:45,280 --> 00:06:46,280
我们这里是1

188
00:06:47,640 --> 00:06:49,680
如果你是复杂点图片

189
00:06:49,680 --> 00:06:51,360
你可能剩下5或者10

190
00:06:51,960 --> 00:06:54,920
接下来5就是分别对应的是

191
00:06:54,920 --> 00:06:58,960
你的标号和你每一个框

192
00:06:58,960 --> 00:07:00,240
它的4个坐标

193
00:07:00,840 --> 00:07:01,600
当4个坐标

194
00:07:01,600 --> 00:07:02,519
你还是得搞清楚

195
00:07:02,519 --> 00:07:03,600
这个4个坐标

196
00:07:03,600 --> 00:07:05,639
到底是用到左上右下

197
00:07:05,680 --> 00:07:07,360
还是左上高宽

198
00:07:07,360 --> 00:07:08,560
或者我们在代码里面

199
00:07:08,560 --> 00:07:10,319
还给了一个中间和高宽

200
00:07:10,319 --> 00:07:10,600
好

201
00:07:10,600 --> 00:07:12,199
三种不一样的选择

202
00:07:12,319 --> 00:07:13,480
所以你一定要搞清楚

203
00:07:13,480 --> 00:07:17,879
你的框是用什么样的来表示的

204
00:07:19,759 --> 00:07:20,600
但最后的话

205
00:07:20,600 --> 00:07:21,920
我们可以打印看一看

206
00:07:21,920 --> 00:07:24,439
就是我们就拿一个图片出来

207
00:07:24,439 --> 00:07:27,199
然后把你的标号

208
00:07:27,199 --> 00:07:29,240
就是说你看到我们把一个

209
00:07:30,439 --> 00:07:32,280
就batch1

210
00:07:32,280 --> 00:07:35,360
然后里面前面10个拿出来

211
00:07:36,199 --> 00:07:37,680
然后这个是

212
00:07:37,720 --> 00:07:39,840
另外我们要拿的是你的

213
00:07:39,879 --> 00:07:40,680
第一个

214
00:07:40,680 --> 00:07:42,240
就是说最后的4个页

215
00:07:42,519 --> 00:07:43,840
因为第一页是你的标号

216
00:07:43,840 --> 00:07:44,720
我们就不需要

217
00:07:45,160 --> 00:07:46,199
所以然后拿出来之后

218
00:07:46,199 --> 00:07:47,920
就是你的毛框

219
00:07:48,480 --> 00:07:49,360
不是你的毛框

220
00:07:49,360 --> 00:07:50,560
是你的边框

221
00:07:51,000 --> 00:07:52,480
然后边框这个地方

222
00:07:52,480 --> 00:07:54,160
我们一般用的是

223
00:07:55,160 --> 00:07:56,600
0到1之间

224
00:07:56,639 --> 00:07:59,879
通常边框是我们是存起来

225
00:07:59,879 --> 00:08:02,159
是除了你的高宽

226
00:08:02,439 --> 00:08:04,279
这就是为什么我们可以回到前面

227
00:08:04,279 --> 00:08:06,159
我们刚刚其实没有讲这一点

228
00:08:06,600 --> 00:08:08,319
其实应该是被我遮住了一点

229
00:08:11,879 --> 00:08:12,519
就这个地方

230
00:08:12,519 --> 00:08:14,759
我们其实是把你的标号

231
00:08:14,759 --> 00:08:16,120
给你除了256

232
00:08:16,159 --> 00:08:17,480
所以虽然你存起来

233
00:08:17,480 --> 00:08:19,439
是按照像素位置存的

234
00:08:19,439 --> 00:08:20,519
但是我们读的时候

235
00:08:20,519 --> 00:08:22,519
其实读到把位置

236
00:08:23,360 --> 00:08:24,319
除以你的高宽

237
00:08:24,319 --> 00:08:26,399
就变成0到1之间一个实数去了

238
00:08:26,719 --> 00:08:28,240
这是我们刚刚做的操作

239
00:08:28,240 --> 00:08:30,280
所以就是边框在这个地方

240
00:08:30,280 --> 00:08:31,400
你需要非常小心

241
00:08:31,400 --> 00:08:32,919
你到底是按像素

242
00:08:33,080 --> 00:08:34,360
位单位存

243
00:08:34,399 --> 00:08:37,000
还是按照0和1之间的实数存

244
00:08:37,000 --> 00:08:39,840
以及你的格式是什么样子

245
00:08:41,120 --> 00:08:42,759
所以这个地方我们就是

246
00:08:43,639 --> 00:08:46,519
乘以我们要乘以乘回我们256

247
00:08:46,639 --> 00:08:47,639
然后可以画出来

248
00:08:47,919 --> 00:08:49,960
就基本上看到是个比较简单

249
00:08:50,159 --> 00:08:51,120
就是一个图片

250
00:08:51,279 --> 00:08:53,360
我们就随随便找了一点图片

251
00:08:53,399 --> 00:08:55,519
然后里面拿一个香蕉

252
00:08:55,519 --> 00:08:57,039
香蕉你可以转一转

253
00:08:57,039 --> 00:08:59,079
然后把它随机拉一拉

254
00:08:59,199 --> 00:09:02,000
就是一个非常简单的一个数据集

255
00:09:02,000 --> 00:09:03,319
就可以看到是说

256
00:09:03,360 --> 00:09:05,719
每一次我们可以看到香蕉

257
00:09:05,879 --> 00:09:06,719
有一个框框

258
00:09:06,719 --> 00:09:08,000
把它框在这个地方

259
00:09:08,360 --> 00:09:11,199
所以这是最简单的一个

260
00:09:11,599 --> 00:09:12,919
目标检测数据集

261
00:09:13,240 --> 00:09:14,719
然后你怎么做可视化

262
00:09:14,719 --> 00:09:16,199
就是把图片打印出来

263
00:09:16,279 --> 00:09:17,639
之前我们是每个图片说

264
00:09:17,639 --> 00:09:18,919
大家的label

265
00:09:18,919 --> 00:09:21,279
就标号是一个放在一个标题里面

266
00:09:21,480 --> 00:09:24,279
现在是我们要把你每个物体

267
00:09:24,279 --> 00:09:25,959
它边框给拿出来

268
00:09:26,000 --> 00:09:28,240
这就是物体识别的一般的做法

269
00:09:29,800 --> 00:09:30,280
OK

270
00:09:30,280 --> 00:09:33,680
所以接下来我先来给大家回答一下问题

271
00:09:34,040 --> 00:09:35,600
然后我们再来讲

272
00:09:35,800 --> 00:09:37,720
怎么样去

273
00:09:40,280 --> 00:09:42,800
一般的目标简单算法

274
00:09:42,800 --> 00:09:45,080
是怎么样去预测边框的

