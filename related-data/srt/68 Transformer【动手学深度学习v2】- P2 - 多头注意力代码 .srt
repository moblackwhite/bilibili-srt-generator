1
00:00:00,000 --> 00:00:00,640
好

2
00:00:00,640 --> 00:00:02,600
接下来我们来讲Transformer代码

3
00:00:02,600 --> 00:00:05,400
首先讲的是多头注意力

4
00:00:05,400 --> 00:00:07,679
就是说就跳过了

5
00:00:08,160 --> 00:00:09,720
多头注意力这个东西

6
00:00:09,720 --> 00:00:13,519
代码看上去比较啰嗦

7
00:00:13,519 --> 00:00:15,400
实际上也不难

8
00:00:15,400 --> 00:00:17,080
它是有个

9
00:00:17,080 --> 00:00:18,640
就是你告诉我你的key size

10
00:00:18,640 --> 00:00:19,480
你的query size

11
00:00:19,480 --> 00:00:20,480
你的value size

12
00:00:20,480 --> 00:00:23,240
你的number of hindrance

13
00:00:25,000 --> 00:00:28,080
然后你的你有多少个头

14
00:00:28,080 --> 00:00:29,839
multi head dropout

15
00:00:30,640 --> 00:00:31,879
或者你用不要bios

16
00:00:31,879 --> 00:00:34,200
然后我们看一下怎么回事

17
00:00:34,200 --> 00:00:37,200
我们的tension用的是

18
00:00:37,200 --> 00:00:39,840
data product tension

19
00:00:39,960 --> 00:00:42,280
这样子我们就里面就没有学w了

20
00:00:42,759 --> 00:00:44,200
相对来说比较简单一点

21
00:00:45,719 --> 00:00:47,200
然后就这个东西

22
00:00:47,200 --> 00:00:47,640
这个是什么

23
00:00:47,640 --> 00:00:49,719
这个是对query做

24
00:00:49,719 --> 00:00:51,719
这个东西是对query做

25
00:00:51,719 --> 00:00:55,159
projection的东西

26
00:00:55,679 --> 00:00:56,760
就query size

27
00:00:56,760 --> 00:00:58,400
它是number of hindrance

28
00:00:59,320 --> 00:00:59,960
OK

29
00:00:59,960 --> 00:01:00,960
然后我们等会解释

30
00:01:00,960 --> 00:01:02,000
它是怎么用过去的

31
00:01:02,119 --> 00:01:02,759
number of hindrance

32
00:01:02,759 --> 00:01:04,239
然后这个东西都是一些

33
00:01:04,239 --> 00:01:05,400
都是到number of hindrance

34
00:01:05,400 --> 00:01:09,000
然后forward

35
00:01:09,000 --> 00:01:10,200
你可以看一下forward

36
00:01:10,959 --> 00:01:12,480
forward我对query

37
00:01:12,719 --> 00:01:14,319
key和value干了个什么事情

38
00:01:14,480 --> 00:01:15,719
就是说我首先把query

39
00:01:15,719 --> 00:01:16,920
放到我的w里面

40
00:01:16,920 --> 00:01:18,560
就是说虽然我们是

41
00:01:18,560 --> 00:01:20,039
需要对每一个head

42
00:01:20,200 --> 00:01:22,280
做一个projection

43
00:01:22,280 --> 00:01:23,400
就是说做一个投影

44
00:01:23,960 --> 00:01:26,319
但是我们尽量不想用

45
00:01:26,319 --> 00:01:27,000
做n下

46
00:01:27,159 --> 00:01:28,359
就有n个multi head

47
00:01:28,359 --> 00:01:29,319
然后最好不要做

48
00:01:29,319 --> 00:01:31,040
你想我们做一下就完事

49
00:01:31,239 --> 00:01:32,480
先做一下

50
00:01:32,480 --> 00:01:33,079
做一下之后

51
00:01:33,079 --> 00:01:34,480
我们再把它切回来

52
00:01:34,560 --> 00:01:35,879
就是说这个东西

53
00:01:36,000 --> 00:01:37,280
我这个东西说白了

54
00:01:37,280 --> 00:01:38,159
就是干个什么事情

55
00:01:38,159 --> 00:01:39,239
这个东西

56
00:01:40,480 --> 00:01:41,560
你有多少个head的话

57
00:01:41,960 --> 00:01:44,000
它就把你后面这个维度

58
00:01:44,519 --> 00:01:45,480
就给你切开

59
00:01:45,480 --> 00:01:46,519
切成一个四维出来

60
00:01:46,519 --> 00:01:46,960
对吧

61
00:01:47,120 --> 00:01:49,280
就是把head拿出来

62
00:01:49,280 --> 00:01:50,799
就是把你最后维度

63
00:01:50,960 --> 00:01:53,079
就切成n个head

64
00:01:53,079 --> 00:01:54,719
最后就是number of hindrance

65
00:01:54,719 --> 00:01:55,640
除以number of head

66
00:01:56,079 --> 00:02:00,239
然后又把head的东西

67
00:02:00,239 --> 00:02:01,400
挪到前面一维

68
00:02:01,400 --> 00:02:03,120
就把这两个维度交换

69
00:02:03,879 --> 00:02:05,760
最后丢出一个三维的东西出去

70
00:02:06,280 --> 00:02:08,800
然后又把这两个维度合在一起

71
00:02:08,920 --> 00:02:10,280
这样子就是

72
00:02:10,879 --> 00:02:14,439
batch维度和head维度放在一起了

73
00:02:14,759 --> 00:02:16,000
中间就是你的

74
00:02:17,240 --> 00:02:19,280
sequence length和你的

75
00:02:22,159 --> 00:02:24,400
你那个head要长什么样子

76
00:02:25,920 --> 00:02:27,680
因为你这样子做完操作之后

77
00:02:27,800 --> 00:02:28,920
我就可以直接

78
00:02:29,040 --> 00:02:29,560
先

79
00:02:29,920 --> 00:02:30,640
value is length

80
00:02:30,640 --> 00:02:31,760
我先不管的话

81
00:02:31,760 --> 00:02:32,720
value is length就是你

82
00:02:33,480 --> 00:02:34,280
我们之前有讲过

83
00:02:34,360 --> 00:02:36,760
就是说你要不要遮掉一些

84
00:02:36,760 --> 00:02:38,680
后面的那些padding

85
00:02:39,160 --> 00:02:41,680
就是说我们把head的维度

86
00:02:41,800 --> 00:02:43,800
和batch size维度

87
00:02:43,800 --> 00:02:44,600
并在一起之后

88
00:02:45,160 --> 00:02:46,520
它变成一个三维

89
00:02:46,520 --> 00:02:47,360
3D的东西

90
00:02:47,360 --> 00:02:48,880
3D东西是直接可以用到

91
00:02:48,880 --> 00:02:49,680
tension里面的

92
00:02:50,240 --> 00:02:52,040
就刚刚那个操作主要的好处

93
00:02:52,040 --> 00:02:52,600
就是说

94
00:02:52,639 --> 00:02:53,239
把

95
00:02:53,759 --> 00:02:55,879
每个head的要的投影

96
00:02:55,879 --> 00:02:57,560
做成一个矩阵乘法

97
00:02:57,799 --> 00:03:00,240
然后再通过变换之后

98
00:03:00,359 --> 00:03:01,639
丢到一个tension里面

99
00:03:01,639 --> 00:03:02,680
就不要做每个

100
00:03:02,680 --> 00:03:03,840
每个multi head

101
00:03:03,840 --> 00:03:05,000
都做自己的tension

102
00:03:05,000 --> 00:03:05,919
就直接丢进去

103
00:03:05,919 --> 00:03:07,280
都丢回一个output

104
00:03:08,439 --> 00:03:10,639
output我又把它要转回来

105
00:03:10,639 --> 00:03:11,759
把刚刚那个

106
00:03:11,799 --> 00:03:14,719
就把刚刚那个运算

107
00:03:15,240 --> 00:03:17,039
就把刚刚那个运算要逆转回来

108
00:03:17,039 --> 00:03:18,840
就逆转成一个四维的东西

109
00:03:19,079 --> 00:03:19,680
OK

110
00:03:20,319 --> 00:03:21,800
然后就要把那些

111
00:03:21,800 --> 00:03:23,400
head的维度放到最后

112
00:03:23,400 --> 00:03:25,439
就是拿到一个concat的效果

113
00:03:25,560 --> 00:03:26,400
然后concat的效果

114
00:03:26,400 --> 00:03:28,480
就只丢到w作为输出

115
00:03:28,480 --> 00:03:29,480
就完事了

116
00:03:29,920 --> 00:03:30,400
OK

117
00:03:30,400 --> 00:03:31,640
就我们稍微讲的快一点

118
00:03:31,719 --> 00:03:33,080
就是说大家去理解一下

119
00:03:33,080 --> 00:03:35,159
就是说具体怎么实现了

120
00:03:35,159 --> 00:03:36,159
就具体实现的

121
00:03:36,159 --> 00:03:37,520
为什么这么绕

122
00:03:37,520 --> 00:03:38,200
是因为

123
00:03:38,240 --> 00:03:40,319
就想不就不想要那个for loop

124
00:03:40,319 --> 00:03:41,680
就你不要每个head

125
00:03:41,680 --> 00:03:43,319
都去自己跑一遍

126
00:03:43,640 --> 00:03:44,280
这样子的话

127
00:03:44,280 --> 00:03:45,360
你的效率会比较低

128
00:03:45,360 --> 00:03:47,360
就是说尽量你要把它一次性

129
00:03:47,360 --> 00:03:48,360
一口气做完

130
00:03:48,360 --> 00:03:50,800
通过不断的reshape做完

131
00:03:51,000 --> 00:03:51,320
这个东西

132
00:03:51,320 --> 00:03:53,200
可能大家理解会有一点点难

133
00:03:53,480 --> 00:03:56,160
但我建议大家等会仔细去看一下

134
00:03:56,160 --> 00:03:58,520
到底是那些shape是怎么在变化

135
00:03:59,680 --> 00:04:00,280
OK

136
00:04:00,720 --> 00:04:02,600
然后我们也跳过了

137
00:04:02,680 --> 00:04:04,280
所以基本上看一下

138
00:04:04,280 --> 00:04:05,080
就是说

139
00:04:05,120 --> 00:04:06,520
这个就是一个layer了

140
00:04:07,320 --> 00:04:07,880
这layer

141
00:04:08,000 --> 00:04:10,120
假设我们就全部把你的hinder size

142
00:04:10,120 --> 00:04:10,840
设成100

143
00:04:11,000 --> 00:04:12,360
number of head设成5的话

144
00:04:12,960 --> 00:04:14,280
那么你就是

145
00:04:14,320 --> 00:04:17,240
我假设给你一个x是什么

146
00:04:17,240 --> 00:04:18,920
给你一个batch size等于2

147
00:04:18,920 --> 00:04:20,639
number of queries是4

148
00:04:20,639 --> 00:04:22,480
number of hinder也是4的东西

149
00:04:23,680 --> 00:04:24,639
那么你的y

150
00:04:24,639 --> 00:04:25,680
那

151
00:04:25,800 --> 00:04:27,800
y就是说你的query

152
00:04:27,800 --> 00:04:28,120
key

153
00:04:28,199 --> 00:04:29,879
我们也是生成一样的东西的情况下

154
00:04:29,879 --> 00:04:31,079
丢回去之后

155
00:04:31,079 --> 00:04:32,280
你会发现它的输出

156
00:04:33,160 --> 00:04:34,519
跟你的y应该是一样的

157
00:04:34,519 --> 00:04:35,639
就是也是

158
00:04:36,680 --> 00:04:37,840
24100

159
00:04:37,840 --> 00:04:38,160
OK

160
00:04:38,160 --> 00:04:40,360
你的y你的xy这里都是24100

161
00:04:40,519 --> 00:04:41,800
你输出也是24100

162
00:04:42,560 --> 00:04:43,680
所以就是说

163
00:04:43,960 --> 00:04:44,800
基本上

164
00:04:45,160 --> 00:04:47,040
假设你是self-attention的话

165
00:04:47,920 --> 00:04:48,680
什么东西

166
00:04:48,680 --> 00:04:49,800
什么的shape进去

167
00:04:49,840 --> 00:04:51,360
什么东西出来

168
00:04:51,639 --> 00:04:53,720
就是你理解有这个东西

169
00:04:53,720 --> 00:04:54,840
就这样子的话

170
00:04:54,840 --> 00:04:56,560
你就要老

171
00:04:56,560 --> 00:04:58,160
老子就知道这个东西怎么用

172
00:04:58,160 --> 00:04:59,800
怎么样放在我的网络里面

173
00:04:59,960 --> 00:05:00,560
OK

